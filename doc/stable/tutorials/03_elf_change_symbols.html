<!doctypehtml><html data-content_root=../ lang=en><meta charset=utf-8><meta content=width=device-width,initial-scale=1.0 name=viewport><meta content=width=device-width,initial-scale=1 name=viewport><meta content=width=device-width,initial-scale=1 name=viewport><meta content=ie=edge http-equiv=x-ua-compatible><meta content="Copy to clipboard"name=lang:clipboard.copy><meta content="Copied to clipboard"name=lang:clipboard.copied><meta content=en name=lang:search.language><meta content=True name=lang:search.pipeline.stopwords><meta content=True name=lang:search.pipeline.trimmer><meta content="No matching documents"name=lang:search.result.none><meta content="1 matching document"name=lang:search.result.one><meta content="# matching documents"name=lang:search.result.other><meta content=[\s\-]+ name=lang:search.tokenizer><meta content="LIEF Documentation"name=Description><link crossorigin href=https://fonts.gstatic.com/ rel=preconnect><script src=../_static/javascripts/vendor.min.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css rel=stylesheet><link href=../_static/favicon.ico rel=apple-touch-icon><title>03 - Play with ELF symbols — LIEF Documentation</title><link href=../_static/fonts/material-icons.css rel=stylesheet><link href=../_static/stylesheets/vendor.min.css rel=stylesheet><link href=../_static/pygments.css?v=3d3fbe02 rel=stylesheet><link href=../_static/basic.css?v=eeb27264 rel=stylesheet><link href=../_static/graphviz.css?v=eafc0fe6 rel=stylesheet><link href=../_static/css/custom.css?v=d79dd603 rel=stylesheet><link href=../_static/tabs.css?v=a5c4661c rel=stylesheet><script src=../_static/documentation_options.js?v=4befc426></script><script src=../_static/doctools.js?v=888ff710></script><script src=../_static/sphinx_highlight.js?v=dc90522c></script><link href=../_static/favicon.ico rel=icon><link href=../genindex.html rel=index title=Index><link href=../search.html rel=search title=Search><link title="04 - ELF Hooking"href=04_elf_hooking.html rel=next><link title="02 - Create a PE from scratch"href=02_pe_from_scratch.html rel=prev><link href=../_static/stylesheets/theme.css rel=stylesheet><link href=../_static/stylesheets/theme-fixes.css rel=stylesheet><body data-md-color-accent=cyan data-md-color-primary=blue dir=ltr><nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom fixed-top"role=navigation><a class=navbar-brand href=../index.html>LIEF Documentation</a><button class=navbar-toggler data-target=#navbar-collapse data-toggle=collapse><span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse justify-content-center mt-2 mt-lg-0"id=navbar-collapse><ul class="navbar-nav position-relative px-lg-6 px-xl-8"><li class=nav-item><a class=nav-link href=https://lief.re/> <i class="fa-solid fa-house mr-3"></i>Home </a><li class=nav-item><a class=nav-link href=https://lief.re//blog> <i class="fa-solid fa-rss mr-3"></i>Blog </a><li class=nav-item><a class=nav-link href=https://lief.re//download> <i class="fa-solid fa-download mr-3"></i>Download </a><li class="nav-item dropdown"><a class="nav-link dropdown-toggle"aria-expanded=false data-toggle=dropdown href=# role=button> <i class="fa-solid fa-book mr-3"></i>Documentation </a> <div class=dropdown-menu role=menu><a class=dropdown-item href=https://lief.re//doc/latest/doxygen>Doxygen</a></div><li class=nav-item><a class=nav-link href=https://lief.re//about> <i class="fa-solid fa-bars-staggered mr-3"></i>About </a><li class=nav-item><a class="btn btn-outline-pink"href=https://github.com/sponsors/lief-project/ target=_blank> <i class="fa-solid fa-heart mr-3"></i> Sponsor </a></ul></div></nav><div class="container-fluid container-docs"><div class=row><div class="col-12 col-lg-3 col-xl-2 border-lg-right py-lg-5 pl-lg-4 docs-sidebar docs-sidebar-left"><div class="collapse d-lg-block mb-6 mb-lg-0"id=sidebar-collapse><form action=../search.html method=GET name=search><input autocapitalize=off autocomplete=off class=form-control data-md-component=query data-md-state=active name=q placeholder=Search spellcheck=false></form><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=../intro.html>Introduction</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=../installation.html>Installation and Integration</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=../getting_started.html>Getting Started</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=../compilation.html>Compilation</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=../error_handling.html>Error Handling</a></ul><div class="text-darkblue text-uppercase font-size-normal font-weight-bolder mt-4 pt-2 mb-2"><span class=caption-text><i class="fa-solid fa-layer-group"> </i>Tutorials</span></div><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=01_play_with_formats.html>01 - Parse and manipulate formats</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=02_pe_from_scratch.html>02 - Create a PE from scratch</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=#>03 - Play with ELF symbols</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=04_elf_hooking.html>04 - ELF Hooking</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=05_elf_infect_plt_got.html>05 - Infecting the plt/got</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=06_pe_hooking.html>06 - PE Hooking (Deprecated)</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=07_pe_resource.html>07 - PE Resources</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=08_elf_bin2lib.html>08 - Transforming an ELF executable into a library</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=09_frida_lief.html>09 - How to use frida on a non-rooted device</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=10_android_formats.html>10 - Android formats</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=11_macho_modification.html>11 - Mach-O Modification</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=12_elf_coredump.html>12 - ELF Coredump</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=13_pe_authenticode.html>13 - PE Authenticode</a></ul><div class="text-darkblue text-uppercase font-size-normal font-weight-bolder mt-4 pt-2 mb-2"><span class=caption-text><i class="fa-solid fa-code"> </i>API</span></div><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=../api/python/index.html><em class="fa fa-brands fa-python"></em> Python</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=../api/cpp/index.html><em class="fa fa-regular fa-file-code"></em> C++</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=../api/c/index.html><em class="fa fa-regular fa-file-code"></em> C</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=../api/rust/index.html><em class="fa fa-brands fa-rust"></em> Rust</a></ul><div class="text-darkblue text-uppercase font-size-normal font-weight-bolder mt-4 pt-2 mb-2"><span class=caption-text><i class="fa-solid fa-hat-wizard"> </i>LIEF Extended</span></div><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=../extended/intro.html><em class="fa fa-cubes"></em> What is LIEF Extended?</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=../extended/dwarf/index.html><em class="fa fa-solid fa-bars-staggered"></em> DWARF</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=../extended/pdb/index.html><em class="fa fa-brands fa-windows"></em> PDB</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=../extended/objc/index.html><em class="fa fa-brands fa-apple"></em> Objective-C</a></ul><div class="text-darkblue text-uppercase font-size-normal font-weight-bolder mt-4 pt-2 mb-2"><span class=caption-text><i class="fa-brands fa-space-awesome"> </i>Extra Information</span></div><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=../formats/index.html>Formats</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=../references.html>References</a></ul><ul class="list-unstyled mt-3"><li><a class="text-darkblue font-size-sm d-block mb-2"href=../changelog.html>Changelog</a></ul></div><hr><span class="svg-icon text-purple mr-1 relative-top--1"> <svg viewbox="0 0 512 512"height=512 width=512 xmlns=http://www.w3.org/2000/svg><title>ionicons-v5-d</title><circle cx=160 cy=96 r=48 style=fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px></circle><circle cx=160 cy=416 r=48 style=fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px></circle><line style=fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px x1=160 x2=160 y1=368 y2=144></line><circle cx=352 cy=160 r=48 style=fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px></circle><path d=M352,208c0,128-192,48-192,160 style=fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px></path></svg> </span><a class=text-darkblue href=https://github.com/lief-project/LIEF/commits/>0.15.1</a><br> Last updated on 23/07/2024, 08:39:38.</div><div class="col-12 col-lg-9 col-xl-8 offset-lg-3 offset-xl-2 py-lg-5 px-lg-6 mb-8"><section id=play-with-elf-symbols><h1 id=tutorials-03-elf-change-symbols--page-root>03 - Play with ELF symbols<a title="Link to this heading"class=headerlink href=#tutorials-03-elf-change-symbols--page-root>¶</a></h1><p>In this tutorial, we will see how to modify dynamic symbols in both an executable and a library.<p>Scripts and materials are available here: <a class="reference external"href=https://github.com/lief-project/tutorials/tree/master/03_ELF_change_symbols>materials</a><p>By Romain Thomas - <a class="reference external"href=https://twitter.com/rh0main>@rh0main</a><hr class=docutils><p>When a library is dynamically linked to an executable, the required libraries are referenced in the <code class="docutils literal notranslate"><span class=pre>DT_NEEDED</span></code> entries within the dynamic table (<code class="docutils literal notranslate"><span class=pre>PT_DYNAMIC</span></code>).<p>In addition, the functions imported from this library are referenced in the dynamic symbols table with the following attributes:<ul class=simple><li><p><a class="reference internal"href=../api/python/elf.html#lief.ELF.Symbol.value title=lief.ELF.Symbol.value><code class="xref py py-attr docutils literal notranslate"><span class=pre>value</span></code></a> set to <code class="docutils literal notranslate"><span class=pre>0</span></code><li><p><a class="reference internal"href=../api/python/elf.html#lief.ELF.Symbol.type title=lief.ELF.Symbol.type><code class="xref py py-attr docutils literal notranslate"><span class=pre>type</span></code></a> set to <a class="reference internal"href=../api/python/elf.html#lief.ELF.Symbol.TYPE.FUNC title=lief.ELF.Symbol.TYPE.FUNC><code class="xref py py-attr docutils literal notranslate"><span class=pre>FUNC</span></code></a></ul><p>Similarly, when a library exports functions the exported functions are registered in the dynamic symbols table with the following attributes:<ul class=simple><li><p><a class="reference internal"href=../api/python/elf.html#lief.ELF.Symbol.value title=lief.ELF.Symbol.value><code class="xref py py-attr docutils literal notranslate"><span class=pre>value</span></code></a> set to the address of the function in the library<li><p><a class="reference internal"href=../api/python/elf.html#lief.ELF.Symbol.type title=lief.ELF.Symbol.type><code class="xref py py-attr docutils literal notranslate"><span class=pre>type</span></code></a> set to <a class="reference internal"href=../api/python/elf.html#lief.ELF.Symbol.TYPE.FUNC title=lief.ELF.Symbol.TYPE.FUNC><code class="xref py py-attr docutils literal notranslate"><span class=pre>FUNC</span></code></a></ul><p>Imported and exported functions are abstracted in LIEF and one can iterate over these elements through the properties: <a class="reference internal"href=../api/python/abstract.html#lief.Binary.exported_functions title=lief.Binary.exported_functions><code class="xref py py-attr docutils literal notranslate"><span class=pre>exported_functions</span></code></a> and <a class="reference internal"href=../api/python/abstract.html#lief.Binary.imported_functions title=lief.Binary.imported_functions><code class="xref py py-attr docutils literal notranslate"><span class=pre>imported_functions</span></code></a><div class="highlight-python notranslate"><div class=highlight><pre><span></span><span class=kn>import</span> <span class=nn>lief</span>
<span class=n>binary</span>  <span class=o>=</span> <span class=n>lief</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=s2>"/usr/bin/ls"</span><span class=p>)</span>
<span class=n>library</span> <span class=o>=</span> <span class=n>lief</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=s2>"/usr/lib/libc.so.6"</span><span class=p>)</span>

<span class=nb>print</span><span class=p>(</span><span class=n>binary</span><span class=o>.</span><span class=n>imported_functions</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>library</span><span class=o>.</span><span class=n>exported_functions</span><span class=p>)</span>
</pre></div></div><p>When analyzing a binary, the imported functions can reveal information about the underlying functionalities of the binary. To avoid revealing the imported symbols, one solution could consist in statically linking the library with the executable. Another solution is to blow the reverser’s mind by swapping these symbols which is the purpose of this tutorial.<p>Let’s consider the following code:<div class="highlight-C notranslate"><div class=highlight><pre><span></span><span class=cp>#include</span><span class=w> </span><span class=cpf>&LTstdio.h></span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&LTstdlib.h></span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&LTmath.h></span>

<span class=kt>double</span><span class=w> </span><span class=nf>hashme</span><span class=p>(</span><span class=kt>double</span><span class=w> </span><span class=n>input</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>pow</span><span class=p>(</span><span class=n>input</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>log</span><span class=p>(</span><span class=n>input</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>3</span><span class=p>);</span>
<span class=p>}</span>

<span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>argc</span><span class=p>,</span><span class=w> </span><span class=kt>char</span><span class=o>**</span><span class=w> </span><span class=n>argv</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>argc</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>"Usage: %s N</span><span class=se>\n</span><span class=s>"</span><span class=p>,</span><span class=w> </span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>EXIT_FAILURE</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=kt>double</span><span class=w> </span><span class=n>N</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>double</span><span class=p>)</span><span class=n>atoi</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
<span class=w>  </span><span class=kt>double</span><span class=w> </span><span class=n>hash</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>hashme</span><span class=p>(</span><span class=n>N</span><span class=p>);</span>
<span class=w>  </span><span class=n>printf</span><span class=p>(</span><span class=s>"%f</span><span class=se>\n</span><span class=s>"</span><span class=p>,</span><span class=w> </span><span class=n>hash</span><span class=p>);</span>

<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>EXIT_SUCCESS</span><span class=p>;</span>
<span class=p>}</span>
</pre></div></div><p>Basically, this program takes an integer as a parameter and performs some computation on this value.<div class="highlight-console notranslate"><div class=highlight><pre><span></span><span class=gp>$ </span>hashme<span class=w> </span><span class=m>123</span>
<span class=go>228886645.836282</span>
</pre></div></div><a class="reference internal image-reference"href=../_images/hashme.png><img style="width: 410.4px; height: 325.8px;"alt=../_images/hashme.png class=align-center src=../_images/hashme.png></a><p>The <code class="docutils literal notranslate"><span class=pre>pow</span></code> and <code class="docutils literal notranslate"><span class=pre>log</span></code> functions are located in the <code class="docutils literal notranslate"><span class=pre>libm.so.6</span></code> library. Using LIEF, we can swap this function <strong>name</strong> with other functions <strong>name</strong>. For instance, let’s swap <code class="docutils literal notranslate"><span class=pre>pow</span></code> and <code class="docutils literal notranslate"><span class=pre>log</span></code> with <code class="docutils literal notranslate"><span class=pre>cos</span></code> and <code class="docutils literal notranslate"><span class=pre>sin</span></code>:<p>First, we have to load both the library and the executable:<div class="highlight-python notranslate"><div class=highlight><pre><span></span><span class=ch>#!/usr/bin/env python3</span>
<span class=kn>import</span> <span class=nn>lief</span>

<span class=n>hashme</span> <span class=o>=</span> <span class=n>lief</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=s2>"hashme"</span><span class=p>)</span>
<span class=n>libm</span>  <span class=o>=</span> <span class=n>lief</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=s2>"/usr/lib/libm.so.6"</span><span class=p>)</span>
<span class=c1># Note: the path to libm.so.6 might be different on your system.</span>
</pre></div></div><p>Then, we can change the name of the two imported functions in the <strong>executable</strong>:<div class="highlight-python notranslate"><div class=highlight><pre><span></span><span class=n>hashme_pow_sym</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>i</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>hashme</span><span class=o>.</span><span class=n>imported_symbols</span> <span class=k>if</span> <span class=n>i</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=s2>"pow"</span><span class=p>)</span>
<span class=n>hashme_log_sym</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>i</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>hashme</span><span class=o>.</span><span class=n>imported_symbols</span> <span class=k>if</span> <span class=n>i</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=s2>"log"</span><span class=p>)</span>

<span class=n>hashme_pow_sym</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=s2>"cos"</span>
<span class=n>hashme_log_sym</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=s2>"sin"</span>
</pre></div></div><p>And we need to do the same in the library: the <code class="docutils literal notranslate"><span class=pre>log</span></code> symbol’s name is swapped with <code class="docutils literal notranslate"><span class=pre>sin</span></code> and <code class="docutils literal notranslate"><span class=pre>pow</span></code> with <code class="docutils literal notranslate"><span class=pre>cos</span></code>:<div class="highlight-python notranslate"><div class=highlight><pre><span></span><span class=ch>#!/usr/bin/env python3</span>
<span class=kn>import</span> <span class=nn>lief</span>

<span class=n>hashme</span> <span class=o>=</span> <span class=n>lief</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=s2>"hashme"</span><span class=p>)</span>
<span class=n>libm</span>  <span class=o>=</span> <span class=n>lief</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=s2>"/usr/lib/libm.so.6"</span><span class=p>)</span>


<span class=k>def</span> <span class=nf>swap</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
    <span class=n>symbol_a</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>i</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>obj</span><span class=o>.</span><span class=n>dynamic_symbols</span> <span class=k>if</span> <span class=n>i</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=n>a</span><span class=p>)</span>
    <span class=n>symbol_b</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>i</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>obj</span><span class=o>.</span><span class=n>dynamic_symbols</span> <span class=k>if</span> <span class=n>i</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=n>b</span><span class=p>)</span>
    <span class=n>b_name</span> <span class=o>=</span> <span class=n>symbol_b</span><span class=o>.</span><span class=n>name</span>
    <span class=n>symbol_b</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>symbol_a</span><span class=o>.</span><span class=n>name</span>
    <span class=n>symbol_a</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>b_name</span>

<span class=n>hashme_pow_sym</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>i</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>hashme</span><span class=o>.</span><span class=n>imported_symbols</span> <span class=k>if</span> <span class=n>i</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=s2>"pow"</span><span class=p>)</span>
<span class=n>hashme_log_sym</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>i</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>hashme</span><span class=o>.</span><span class=n>imported_symbols</span> <span class=k>if</span> <span class=n>i</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=s2>"log"</span><span class=p>)</span>

<span class=n>hashme_pow_sym</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=s2>"cos"</span>
<span class=n>hashme_log_sym</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=s2>"sin"</span>


<span class=n>swap</span><span class=p>(</span><span class=n>libm</span><span class=p>,</span> <span class=s2>"log"</span><span class=p>,</span> <span class=s2>"sin"</span><span class=p>)</span>
<span class=n>swap</span><span class=p>(</span><span class=n>libm</span><span class=p>,</span> <span class=s2>"pow"</span><span class=p>,</span> <span class=s2>"cos"</span><span class=p>)</span>

<span class=n>hashme</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>"hashme.obf"</span><span class=p>)</span>
<span class=n>libm</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>"libm.so.6"</span><span class=p>)</span>
</pre></div></div><a class="reference internal image-reference"href=../_images/hashme_obf.png><img style="width: 434.4px; height: 334.8px;"alt=../_images/hashme_obf.png class=align-center src=../_images/hashme_obf.png></a><p>At this point, we have a modified version of <code class="docutils literal notranslate"><span class=pre>libm.so</span></code> in the same directory as <code class="docutils literal notranslate"><span class=pre>hashme.obf</span></code>. To force loading this modified version of <code class="docutils literal notranslate"><span class=pre>libm.so</span></code>, we can set the environment variable <code class="docutils literal notranslate"><span class=pre>LD_LIBRARY_PATH</span></code>:<div class="highlight-console notranslate"><div class=highlight><pre><span></span><span class=gp>$ </span><span class=nv>LD_LIBRARY_PATH</span><span class=o>=</span>.<span class=w> </span>hashme.obf<span class=w> </span><span class=m>123</span>
<span class=go>228886645.836282</span>
</pre></div></div><p>Without this environment variable, the Linux loader would resolve <code class="docutils literal notranslate"><span class=pre>libm.so</span></code> with the original path and the computation would be done with <code class="docutils literal notranslate"><span class=pre>sin</span></code> and <code class="docutils literal notranslate"><span class=pre>cos</span></code>:<div class="highlight-console notranslate"><div class=highlight><pre><span></span><span class=gp>$ </span>hashme.obf<span class=w> </span><span class=m>123</span>
<span class=go>-0.557978</span>
</pre></div></div><p>One other more realistic use case could consist in swapping symbols in cryptographic libraries like OpenSSL. For instance, <code class="docutils literal notranslate"><span class=pre>EVP_DecryptInit</span></code> and <code class="docutils literal notranslate"><span class=pre>EVP_EncryptInit</span></code> have the same prototype and could be swapped.</section></div><div class="col-xl-2 d-none d-xl-block px-0 py-5 docs-sidebar docs-sidebar-right"></div></div></div>