<!doctype html><html lang=en-us prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=description content><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=google-site-verification content="OcWjYs0PdsQZtqu1ms5QSr5FplDf_t5GEneU---wWzM"><meta name=description content="This blog post highlights the main changes in LIEF v0.13.0"><meta name=keywords content><meta property="og:type" content="article"><meta property="og:description" content="This blog post highlights the main changes in LIEF v0.13.0"><meta property="og:title" content="LIEF v0.13.0"><meta property="og:site_name" content="LIEF"><meta property="og:image" content="https://lief-project.github.io/blog/2023-04-09-lief-0-13-0/featured.webp"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content><meta property="og:image:height" content><meta property="og:url" content="https://lief-project.github.io/blog/2023-04-09-lief-0-13-0/"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2023-04-09
"><meta property="article:modified_time" content="2023-04-09
"><meta name=twitter:card content="summary"><meta name=twitter:site content="@lief_project"><meta name=twitter:creator content="@lief_project"><meta name=twitter:title content="LIEF v0.13.0 | LIEF"><meta name=twitter:description content="This blog post highlights the main changes in LIEF v0.13.0 | LIEF"><meta property="twitter:image:src" content="https://lief-project.github.io/blog/2023-04-09-lief-0-13-0/featured.webp"><meta name=twitter:domain content="https://lief-project.github.io/blog/2023-04-09-lief-0-13-0/"><title>LIEF</title>
<link rel=canonical href=https://lief-project.github.io/blog/2023-04-09-lief-0-13-0/><link rel=stylesheet type=text/css href=https://lief-project.github.io//css/theme.min.css><link rel=stylesheet type=text/css href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css><link rel=stylesheet type=text/css href=https://lief-project.github.io//css/vendor.min.css><link rel=stylesheet type=text/css href=https://lief-project.github.io//css/termynal.css><link rel=stylesheet type=text/css href=https://lief-project.github.io//css/animate.css><link rel=apple-touch-icon href=https://lief-project.github.io//img/favicon.ico type=image/x-icon><link rel="shortcut icon" href=https://lief-project.github.io//img/favicon.ico type=image/x-icon><link rel=icon href=https://lief-project.github.io//img/favicon.ico type=image/x-icon><style></style></head><body class=bg-light><nav class="navbar navbar-expand-lg navbar-light bg-light position-absolute w-100 bg-white" role=navigation><div class="container position-relative"><a href=https://lief-project.github.io/ class=navbar-brand>LIEF</a>
<button class=navbar-toggler data-toggle=collapse data-target=#navbar-collapse>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse justify-content-end mt-2 mt-lg-0" id=navbar-collapse><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://lief-project.github.io/><i class="fa-solid fa-house mr-3"></i>
Home</a></li><li class=nav-item><a class=nav-link href=https://lief-project.github.io/blog><i class="fa-solid fa-rss mr-3"></i>
Blog</a></li><li class=nav-item><a class=nav-link href=https://lief-project.github.io/download><i class="fa-solid fa-download mr-3"></i>
Download</a></li><li class="nav-item dropdown"><a href=https://lief-project.github.io/doc/latest class="nav-link dropdown-toggle" data-toggle=dropdown><i class="fa-solid fa-book mr-3"></i>
Documentation</a><div class="dropdown-menu px-4" role=menu><a class="dropdown-item d-flex align-items-center border-bottom border-gray-100 p-2" href=https://lief-project.github.io/doc/latest/><span class="svg-icon text-purple mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"><title>ionicons-v5-m</title><path d="M160 389a20.91 20.91.0 01-13.82-5.2l-128-112a21 21 0 010-31.6l128-112a21 21 0 0127.66 31.61L63.89 256l109.94 96.19A21 21 0 01160 389z"/><path d="M352 389a21 21 0 01-13.84-36.81L448.11 256 338.17 159.81a21 21 0 0127.66-31.61l128 112a21 21 0 010 31.6l-128 112A20.89 20.89.0 01352 389z"/></svg>
</span><span><p class=mb-0>API
<span class="badge badge-pastel-success font-weight-bold pt-2 ml-1">Latest</span></p><span class=text-secondary>Sphinx & Doxygen API documentation</span>
</span></a><a class="dropdown-item d-flex align-items-center border-bottom border-gray-100 p-2" href=https://lief-project.github.io/doc/stable/><span class="svg-icon text-purple mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"><title>ionicons-v5-m</title><path d="M160 389a20.91 20.91.0 01-13.82-5.2l-128-112a21 21 0 010-31.6l128-112a21 21 0 0127.66 31.61L63.89 256l109.94 96.19A21 21 0 01160 389z"/><path d="M352 389a21 21 0 01-13.84-36.81L448.11 256 338.17 159.81a21 21 0 0127.66-31.61l128 112a21 21 0 010 31.6l-128 112A20.89 20.89.0 01352 389z"/></svg>
</span><span><p class=mb-0>API
<span class="badge badge-pastel-primary font-weight-bold pt-2 ml-1">Stable</span></p><span class=text-secondary>Sphinx & Doxygen API documentation</span>
</span></a><a class="dropdown-item d-flex align-items-center border-bottom border-gray-100 p-2" href=https://lief-project.github.io/doc/latest/changelog.html><span class="svg-icon text-purple mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"><title>ionicons-v5-j</title><path d="M256 256s-48-96-126-96c-54.12.0-98 43-98 96s43.88 96 98 96c30 0 56.45-13.18 78-32" style="fill:none;stroke:#000;stroke-linecap:round;stroke-miterlimit:10;stroke-width:48px"/><path d="M256 256s48 96 126 96c54.12.0 98-43 98-96s-43.88-96-98-96c-29.37.0-56.66 13.75-78 32" style="fill:none;stroke:#000;stroke-linecap:round;stroke-miterlimit:10;stroke-width:48px"/></svg>
</span><span><p class=mb-0>Changelog</p><span class=text-secondary>See all updates</span></span></a></div></li><li class=nav-item><a class=nav-link href=https://lief-project.github.io/about><i class="fa-solid fa-bars-staggered mr-3"></i>
About</a></li><li class="nav-item ml-lg-3 mt-3 mt-lg-0"><a class="hover-lift-light mt-1" href=https://github.com/lief-project/LIEF target=_blank><i class="fab fa-2x fa-github text-darkblue"></i></a></li><li class="nav-item ml-lg-3 mt-3 mt-lg-0"><a href=https://github.com/sponsors/lief-project/ class="btn btn-outline-pink" target=_blank><i class="fa-solid fa-heart mr-3"></i> Sponsor</a></li></ul></div></div></nav><div class="h-200 h-md-250 bg-light"></div><section class="bg-light pb-8"><div class="container fx-fade-up"><div class="row justify-content-center"><div class="col-lg-12 bg-white shadow-light-lg rounded py-5 px-4 px-md-7 mt-n6"><div class="avatar d-block mx-auto mt-n6 relative-top--7"><a href=https://www.romainthomas.fr target=_blank><img src=https://lief-project.github.io/img/avatar/romain.png class="rounded-circle avatar-image shadow" alt=Avatar></a></div><h2 class="text-center font-weight-normal mt-4">LIEF v0.13.0</h2><div class="text-center text-muted font-size-sm mt-3"><span class=mr-3><span class="svg-icon svg-icon-sm text-muted relative-top--1 mr-1"><svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"><title>ionicons-v5-k</title><polygon points="364.13 125.25 87 403 64 448 108.99 425 386.75 147.87 364.13 125.25" style="fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/><path d="M420.69 68.69 398.07 91.31l22.62 22.63 22.62-22.63a16 16 0 000-22.62h0a16 16 0 00-22.62.0z" style="fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/></svg>
</span><a href=https://www.romainthomas.fr target=_blank>Romain Thomas </a></span><span class=ml-3><i class="far fa-calendar fa-xs mr-1 relative-top--1"></i>
April 9, 2023</span></div><img src=https://lief-project.github.io//img/waves.png class="d-block mx-auto mt-4 mb-5" alt=Wave><div class=text-dark><p>LIEF v0.13.0 is eventually out! The full changelog is available <a href=https://lief-project.github.io/doc/stable/changelog.html#april-9-2023>here</a>,
but for those who would like an highlight on the main changes here they are.</p><h2 id=mach-o-in-memory-parser>Mach-O in Memory Parser</h2><p>LIEF is now able to parse a Mach-O file from an in-memory pointer:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>uintptr_t mhdr <span style=color:#000;font-weight:700>=</span> ...; <span style=color:#998;font-style:italic>// Absolute address to an in-memory Mach-O file
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>auto</span> macho <span style=color:#000;font-weight:700>=</span> LIEF<span style=color:#000;font-weight:700>::</span>MachO<span style=color:#000;font-weight:700>::</span>Parser<span style=color:#000;font-weight:700>::</span>parse_from_memory(mhdr);
</span></span></code></pre></div><p>This feature can be handy on iOS to access the in-memory content of the binary.
Firstly because some parts of the application code are encrypted (thanks to the <code>LC_ENCRYPTION_INFO</code> commands).
Secondly, it can be used on protected code that fills the <code>__data</code> segment
with clear (original) strings (c.f. <a href=https://www.romainthomas.fr/post/21-07-pokemongo-anti-frida-jailbreak-bypass/#what-about-lief>Gotta Catch &lsquo;Em All: Frida & jailbreak detection</a>).</p><p>This feature could also be used in pair with <code>_dyld_get_image_header</code>, once we are
injected into the targeted process:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>size_t count <span style=color:#000;font-weight:700>=</span> _dyld_image_count();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#000;font-weight:700>for</span> (size_t i <span style=color:#000;font-weight:700>=</span> <span style=color:#099>0</span>; i <span style=color:#000;font-weight:700>&lt;</span> count; <span style=color:#000;font-weight:700>++</span>i) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>  llvm<span style=color:#000;font-weight:700>::</span>StringRef Name <span style=color:#000;font-weight:700>=</span> _dyld_get_image_name(i);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>  <span style=color:#000;font-weight:700>if</span> (Name.contains(<span style=color:#d14>&#34;MyApp.app/Target&#34;</span>)) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    <span style=color:#000;font-weight:700>auto</span><span style=color:#000;font-weight:700>*</span> mhdr <span style=color:#000;font-weight:700>=</span> _dyld_get_image_header(i);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    <span style=color:#000;font-weight:700>auto</span> macho <span style=color:#000;font-weight:700>=</span> MachO<span style=color:#000;font-weight:700>::</span>Parser<span style=color:#000;font-weight:700>::</span>parse_from_memory((uintptr_t)mhdr);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>}
</span></span></code></pre></div><p>It might also work to access the dyld shared cache libraries but this aspect
does not have been heavily tested.</p><h2 id=framed-elf-sections>Framed ELF Sections</h2><p>The ELF format is &ndash; by far &ndash; the most tricky format especially when it comes
dealing with sections and segments. These ELF structures are two different ways
of <em>slicing</em> the binary data:</p><ol><li>Sections are used by the compiler and the linker</li><li>Segments are used by the system loader.</li></ol><p>LIEF implements a mechanism to deal with this dual representation so that if the user
updates the <code>.text</code> section, the changes are also committed in the associated segment (if any).</p><p>It turns out that in some scenarios<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>, we might want to NOT <em>commit</em> the changes we are doing
on the sections. The <code>lief.ELF.Section.as_frame()</code> function can be used to make the section &ldquo;<em>frame only</em>&rdquo;.
All the attributes of the section will be committed in the final ELF binary but
LIEF won&rsquo;t consider this section to write the content in the binary.</p><p>One can use &ndash; for instance &ndash; this function to corrupt sections attributes:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>elf <span style=color:#000;font-weight:700>=</span> lief<span style=color:#000;font-weight:700>.</span>parse(<span style=color:#d14>&#34;/bin/ls&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>text <span style=color:#000;font-weight:700>=</span> elf<span style=color:#000;font-weight:700>.</span>get_section(<span style=color:#d14>&#34;.text&#34;</span>)<span style=color:#000;font-weight:700>.</span>as_frame()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>text<span style=color:#000;font-weight:700>.</span>offset <span style=color:#000;font-weight:700>=</span> <span style=color:#099>0xffffff</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>elf<span style=color:#000;font-weight:700>.</span>write(<span style=color:#d14>&#34;ls.modified&#34;</span>)
</span></span></code></pre></div><p>As the <code>.text</code> section is set as &ldquo;framed&rdquo;, its <code>0xffffff</code> offset is not considered
for changing its content. Thus this code does not update anything:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>text<span style=color:#000;font-weight:700>.</span>content <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>...</span>
</span></span></code></pre></div><p>Since the ELF loader only relies on segment, this modification does not affect
the execution of the modified binary.</p><h2 id=internal-changes>Internal Changes</h2><p>As announced in the previous v0.12.0 release, the LIEF&rsquo;s code base is now free
from exceptions and RTTI. This means that the core library can be compiled in
an <code>-fno-exceptions</code> context.</p><p>The Python build process is now compliant with the <a href=https://peps.python.org/pep-0621/>PEP 621</a>
<code>pyproject.toml</code> requirement. You can find out this file, along with <code>config-default.toml</code>,
in the <code>api/python</code> directory. The <code>config-default.toml</code> file can be used to tweak
the compilation of the bindings. This is essentially an interface over the LIEF&rsquo;s cmake option.
Lastly, the <code>setup.py</code> file used for compiling the binding has moved from the root directory
to <code>api/python</code>.</p><p>On top of that, the Python bindings also stubgen interfaces (<code>.pyi</code>) which are
handy for type checking and code completion (cf. <a href=https://github.com/lief-project/LIEF/issues/650>issues/650</a>).</p><h2 id=final-words>Final Words</h2><p>Some features like the Rust bindings are not released yet they still require some ongoing work.
I also really do hope to be able to work on enhancing the PE format modification in the next
release but this will be balanced with the spare time I have to work on it :)</p><p>Thank you for using LIEF!</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://passthesalt.ubicast.tv/videos/the-poor-mans-obfuscator/>https://passthesalt.ubicast.tv/videos/the-poor-mans-obfuscator/</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class="d-flex flex-column flex-sm-row align-items-center border-top border-gray-200 mt-6 py-5"><div class=media><div class="avatar mr-4"><img src=https://lief-project.github.io/img/avatar/romain.png class="avatar-image rounded-circle" alt=Avatar></div><div class=media-body><span class="text-darkblue text-uppercase-xs font-weight-bolder"><a href=https://www.romainthomas.fr target=_blank>Romain Thomas
</a></span><span class="text-muted font-size-sm d-block">Posted on April 9, 2023</span></div></div></div></div></div></div></section><footer class="footer footer-dark bg-dark"><div class="container text-center"><div class=row><div class="col-12 col-md"><h6 class="footer-header mb-4 pb-md-2">LIEF</h6><a href=https://github.com/lief-project/LIEF class=footer-link>Github
</a><a href=https://lief-project.github.io//download class="footer-link mt-2">Download
</a><a href=https://lief-project.github.io//doc/latest class="footer-link mt-2">Documentation</a></div><div class="col-12 col-md mt-5 mt-md-0"><h6 class="footer-header mb-4 pb-md-2">Quarkslab</h6><a href=https://blog.quarkslab.com/ class=footer-link>Blog
</a><a href=https://quarkslab.com/ class="footer-link mt-2">Website</a></div><div class="col-12 col-md mt-5 mt-md-0"><h6 class="footer-header mb-4 pb-md-2">Other Tools</h6><a href=https://qbdi.quarkslab.com/ class=footer-link>QBDI
</a><a href=https://triton.quarkslab.com/ class="footer-link mt-2">Triton</a></div></div><div class="d-flex justify-content-center mt-6"><a href=https://twitter.com/lief_project class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-twitter fa-lg"></i>
</span></a><a href=https://pypi.org/project/lief/ class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-python fa-lg"></i>
</span></a><a href=https://github.com/lief-project/LIEF class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-github fa-lg"></i>
</span></a><a href=https://discord.gg/7hRFGWYedu class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-discord fa-lg"></i>
</span></a><a href=https://lief-project.github.io//index.xml class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fas fa-rss-square fa-lg"></i></span></a></div></div></footer><script src=https://lief-project.github.io//js/vendor.min.js></script><script src=https://lief-project.github.io//js/theme.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js></script><script>$("#copy").tooltip({trigger:"click",placement:"bottom"});function setTooltip(e){$("#copy").tooltip("hide").attr("data-original-title",e).tooltip("show")}function hideTooltip(){setTimeout(function(){$("#copy").tooltip("hide")},1e3)}var clipboard=new ClipboardJS("#copy");clipboard.on("success",function(){setTooltip("Copied!"),hideTooltip()}),clipboard.on("error",function(){setTooltip("Failed!"),hideTooltip()})</script></body></html>