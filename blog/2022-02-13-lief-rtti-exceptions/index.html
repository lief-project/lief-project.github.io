<!doctype html><html lang=en-us prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=description content><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=google-site-verification content="OcWjYs0PdsQZtqu1ms5QSr5FplDf_t5GEneU---wWzM"><meta name=description content="This blog post explains how and why we started to remove the exceptions and the RTTI in LIEF."><meta name=keywords content><meta property="og:type" content="article"><meta property="og:description" content="This blog post explains how and why we started to remove the exceptions and the RTTI in LIEF."><meta property="og:title" content="LIEF RTTI & Exceptions"><meta property="og:site_name" content="LIEF"><meta property="og:image" content="https://lief.re/blog/2022-02-13-lief-rtti-exceptions/featured.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content><meta property="og:image:height" content><meta property="og:url" content="https://lief.re/blog/2022-02-13-lief-rtti-exceptions/"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2022-02-13
"><meta property="article:modified_time" content="2022-02-13
"><meta name=twitter:card content="summary"><meta name=twitter:site content="@lief_project"><meta name=twitter:creator content="@lief_project"><meta name=twitter:title content="LIEF RTTI & Exceptions | LIEF"><meta name=twitter:description content="This blog post explains how and why we started to remove the exceptions and the RTTI in LIEF. | LIEF"><meta property="twitter:image:src" content="https://lief.re/blog/2022-02-13-lief-rtti-exceptions/featured.png"><meta name=twitter:domain content="https://lief.re/blog/2022-02-13-lief-rtti-exceptions/"><title>LIEF</title><link rel=canonical href=https://lief.re/blog/2022-02-13-lief-rtti-exceptions/><link rel=stylesheet type=text/css href=https://lief.re//css/theme.min.css><link rel=stylesheet type=text/css href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css><link rel=stylesheet type=text/css href=https://lief.re//css/vendor.min.css><link rel=stylesheet type=text/css href=https://lief.re//css/termynal.css><link rel=stylesheet type=text/css href=https://lief.re//css/animate.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel=stylesheet type=text/css><link rel=apple-touch-icon href=https://lief.re//img/favicon.ico type=image/x-icon><link rel="shortcut icon" href=https://lief.re//img/favicon.ico type=image/x-icon><link rel=icon href=https://lief.re//img/favicon.ico type=image/x-icon><style></style></head><body class=bg-light><nav class="navbar navbar-expand-lg navbar-light bg-light position-absolute w-100 bg-white" role=navigation><div class="container position-relative"><a href=https://lief.re/ class=navbar-brand>LIEF</a>
<button class=navbar-toggler data-toggle=collapse data-target=#navbar-collapse>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse justify-content-end mt-2 mt-lg-0" id=navbar-collapse><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://lief.re/><i class="fa-solid fa-house mr-3"></i>
Home</a></li><li class=nav-item><a class=nav-link href=https://lief.re/blog><i class="fa-solid fa-rss mr-3"></i>
Blog</a></li><li class=nav-item><a class=nav-link href=https://lief.re/download><i class="fa-solid fa-download mr-3"></i>
Download</a></li><li class="nav-item dropdown"><a href=https://lief.re/doc/latest class="nav-link dropdown-toggle" data-toggle=dropdown><i class="fa-solid fa-book mr-3"></i>
Documentation</a><div class="dropdown-menu px-4" role=menu><a class="dropdown-item d-flex align-items-center border-bottom border-gray-100 p-2" href=https://lief.re/doc/latest/><span class="svg-icon text-purple mr-3"><svg width="512" height="512" viewBox="0 0 512 512"><title>ionicons-v5-m</title><path d="M160 389a20.91 20.91.0 01-13.82-5.2l-128-112a21 21 0 010-31.6l128-112a21 21 0 0127.66 31.61L63.89 256l109.94 96.19A21 21 0 01160 389z"/><path d="M352 389a21 21 0 01-13.84-36.81L448.11 256 338.17 159.81a21 21 0 0127.66-31.61l128 112a21 21 0 010 31.6l-128 112A20.89 20.89.0 01352 389z"/></svg>
</span><span><p class=mb-0>API
<span class="badge badge-pastel-success font-weight-bold pt-2 ml-1">Latest</span></p><span class=text-secondary>Sphinx & Doxygen API documentation</span>
</span></a><a class="dropdown-item d-flex align-items-center border-bottom border-gray-100 p-2" href=https://lief.re/doc/stable/><span class="svg-icon text-purple mr-3"><svg width="512" height="512" viewBox="0 0 512 512"><title>ionicons-v5-m</title><path d="M160 389a20.91 20.91.0 01-13.82-5.2l-128-112a21 21 0 010-31.6l128-112a21 21 0 0127.66 31.61L63.89 256l109.94 96.19A21 21 0 01160 389z"/><path d="M352 389a21 21 0 01-13.84-36.81L448.11 256 338.17 159.81a21 21 0 0127.66-31.61l128 112a21 21 0 010 31.6l-128 112A20.89 20.89.0 01352 389z"/></svg>
</span><span><p class=mb-0>API
<span class="badge badge-pastel-primary font-weight-bold pt-2 ml-1">Stable</span></p><span class=text-secondary>Sphinx & Doxygen API documentation</span>
</span></a><a class="dropdown-item d-flex align-items-center border-bottom border-gray-100 p-2" href=https://lief.re/doc/latest/changelog.html><span class="svg-icon text-purple mr-3"><svg width="512" height="512" viewBox="0 0 512 512"><title>ionicons-v5-j</title><path d="M256 256s-48-96-126-96c-54.12.0-98 43-98 96s43.88 96 98 96c30 0 56.45-13.18 78-32" style="fill:none;stroke:#000;stroke-linecap:round;stroke-miterlimit:10;stroke-width:48px"/><path d="M256 256s48 96 126 96c54.12.0 98-43 98-96s-43.88-96-98-96c-29.37.0-56.66 13.75-78 32" style="fill:none;stroke:#000;stroke-linecap:round;stroke-miterlimit:10;stroke-width:48px"/></svg>
</span><span><p class=mb-0>Changelog</p><span class=text-secondary>See all updates</span></span></a></div></li><li class=nav-item><a class=nav-link href=https://lief.re/about><i class="fa-solid fa-bars-staggered mr-3"></i>
About</a></li><li class="nav-item ml-lg-3 mt-3 mt-lg-0"><a class="hover-lift-light mt-1" href=https://github.com/lief-project/LIEF target=_blank><i class="fab fa-2x fa-github text-darkblue"></i></a></li><li class="nav-item ml-lg-3 mt-3 mt-lg-0"><a class="hover-lift-light mt-1" href=https://discord.gg/jGQtyAYChJ target=_blank><i class="fab fa-2x fa-discord text-darkblue mr-3"></i></a></li><li class="nav-item ml-lg-3 mt-3 mt-lg-0"><a href=https://github.com/sponsors/lief-project/ class="btn btn-outline-pink" target=_blank><i class="fa-solid fa-heart mr-3"></i> Sponsor</a></li></ul></div></div></nav><div class="h-200 h-md-250 bg-light"></div><section class="bg-light pb-8"><div class="container fx-fade-up"><div class="row justify-content-center"><div class="col-lg-12 bg-white shadow-light-lg rounded py-5 px-4 px-md-7 mt-n6"><div class="avatar d-block mx-auto mt-n6 relative-top--7"><a href=https://www.romainthomas.fr target=_blank><img src=https://lief.re/img/avatar/romain.png class="rounded-circle avatar-image shadow" alt=Avatar></a></div><h2 class="text-center font-weight-normal mt-4">LIEF RTTI & Exceptions</h2><div class="text-center text-muted font-size-sm mt-3"><span class=mr-3><span class="svg-icon svg-icon-sm text-muted relative-top--1 mr-1"><svg width="512" height="512" viewBox="0 0 512 512"><title>ionicons-v5-k</title><polygon points="364.13 125.25 87 403 64 448 108.99 425 386.75 147.87 364.13 125.25" style="fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/><path d="M420.69 68.69 398.07 91.31l22.62 22.63 22.62-22.63a16 16 0 000-22.62h0a16 16 0 00-22.62.0z" style="fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/></svg>
</span><a href=https://www.romainthomas.fr target=_blank>Romain Thomas </a></span><span class=ml-3><i class="far fa-calendar fa-xs mr-1 relative-top--1"></i>
February 13, 2022</span></div><img src=https://lief.re//img/waves.png class="d-block mx-auto mt-4 mb-5" alt=Wave><div class=text-dark><h2>try {</h2>When we started to develop LIEF, we choose to manage errors through the C++ exceptions as it is widely
spread in Java.<p>However, with a little hindsight it was not the best choice in the design of LIEF.</p><p>First off, LIEF is a <strong>library</strong> and the API functions that throw exceptions are not compatible
with library&rsquo;s users that are not using exceptions (e.g with the <code>-fno-exceptions</code> flag). It is also considered
as a bad practice quoting from C++ Coding Standards:</p><div class="admonition note"><p class=admonition-title>C++ Coding Standards: Item 62</p><p><i>“Don't throw stones into your neighbor's garden: There is no ubiquitous binary standard for C++ exception
handling.”</i></div><p>For instance, the function <code>LIEF::ELF::Binary::get_section(const std::string& name)</code>
threw an exception if the section were not found.
To avoid raising the exception, the API exposes helpers that can be used to check
&ndash; beforehand &ndash; that it will not take the <em>exception path</em>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#cf222e>if</span> <span style=color:#1f2328>(</span>bin<span style=color:#1f2328>.</span>has_section<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;.toto&#34;</span><span style=color:#1f2328>))</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>  <span style=color:#cf222e>auto</span><span style=color:#0550ae>&amp;</span> sec <span style=color:#0550ae>=</span> bin<span style=color:#1f2328>.</span>get_section<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;.toto&#34;</span><span style=color:#1f2328>);</span> <span style=color:#57606a>// Ok no exception
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#57606a></span><span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#57606a>// With exception:
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#57606a></span><span style=color:#cf222e>try</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>  bin<span style=color:#1f2328>.</span>get_section<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;.toto&#34;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#1f2328>}</span> <span style=color:#cf222e>catch</span> <span style=color:#1f2328>(</span><span style=color:#cf222e>const</span> std<span style=color:#0550ae>::</span>exception<span style=color:#0550ae>&amp;</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>  <span style=color:#57606a>// .toto does not exist :(
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#57606a></span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p>Actually, the <code>has_&lt;element></code> / <code>get_&lt;element></code> pattern hides another issue: <strong>the performances</strong>.</p><p>Basically, <code>has_section(...)</code> iterates over the list of the sections to check if a section
with the given name exists and <code>get_section()</code> iterates <strong>again</strong> on this list to access the section.
<strong>The code performs twice the same iteration</strong>. This is not a big deal for the ELF sections as they
are quite small but it can be problematic for large sequences like the symbols table.</p><p>In LIEF v0.12.0 we changed the API of these functions to return <strong>a pointer</strong> on these objects instead of
<strong>a reference</strong>. If the item can&rsquo;t be found, it returns a <code>nullptr</code>.</p><center><b>The API contract of these functions is changing from raising an exception into returning a <code>nullptr</code>.
The documentation has been updated accordingly and the list of the functions which have changed are listed
<a href=https://gist.github.com/romainthomas/37da45b043c5f8b8db6be2767611f625>here</a></b></center><p>As a result, the previous code can be re-written as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#cf222e>if</span> <span style=color:#1f2328>(</span>bin<span style=color:#1f2328>.</span>has_section<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;.toto&#34;</span><span style=color:#1f2328>))</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>  <span style=color:#cf222e>auto</span><span style=color:#0550ae>*</span> sec <span style=color:#0550ae>=</span> bin<span style=color:#1f2328>.</span>get_section<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;.toto&#34;</span><span style=color:#1f2328>);</span> <span style=color:#57606a>// Non nullptr instead of a reference
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#57606a></span><span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#57606a>// Or:
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#57606a></span><span style=color:#cf222e>if</span> <span style=color:#1f2328>(</span><span style=color:#cf222e>auto</span><span style=color:#0550ae>*</span> sec <span style=color:#0550ae>=</span> bin<span style=color:#1f2328>.</span>get_section<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;.toto&#34;</span><span style=color:#1f2328>))</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>  <span style=color:#57606a>// ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#57606a></span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p>This kind of API change is doable and meaningful for functions that aim at returning an <strong>optional object</strong>
but it is less meaningful to transform a function like:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#cf222e>uint64_t</span> Binary<span style=color:#0550ae>::</span>virtual_address_to_offset<span style=color:#1f2328>(...)</span> <span style=color:#1f2328>{</span> <span style=color:#1f2328>...</span> <span style=color:#1f2328>}</span>
</span></span></code></pre></div><p>that returns an integer (while still potentially raising an exception).</p><p>In LIEF 0.12.0, this kind of function still raises an exception but in the next version (LIEF v0.13.0) the returned
value will be wrapped by <a href=https://github.com/boostorg/leaf><strong>Boost&rsquo;s Leaf</strong></a><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> such as the returned
type will become:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#57606a>// Future returned type
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#57606a></span>result<span style=color:#0550ae>&lt;</span><span style=color:#cf222e>uint64_t</span><span style=color:#0550ae>&gt;</span> Binary<span style=color:#0550ae>::</span>virtual_address_to_offset<span style=color:#1f2328>(...)</span> <span style=color:#1f2328>{</span> <span style=color:#1f2328>...</span> <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#57606a>// To use it:
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#57606a></span><span style=color:#cf222e>auto</span> res <span style=color:#0550ae>=</span> bin<span style=color:#1f2328>.</span>virtual_address_to_offset<span style=color:#1f2328>();</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#cf222e>if</span> <span style=color:#1f2328>(</span><span style=color:#0550ae>!</span>res<span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>  <span style=color:#57606a>// Error
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#57606a></span><span style=color:#1f2328>}</span> <span style=color:#cf222e>else</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>  <span style=color:#cf222e>uint64_t</span> val <span style=color:#0550ae>=</span> res<span style=color:#1f2328>.</span>value<span style=color:#1f2328>();</span> <span style=color:#57606a>// or val = *res
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#57606a></span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p>In LIEF v0.12.0 <strong>only internal/private functions associated with the Parser/Builder module</strong> are using
this mechanism and we plan to move to this mechanism in the public API<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> in LIEF v0.13.0.</p><div class="admonition warning"><p class=admonition-title>Warning</p><p>Boost LEAF is required in the <b>public headers</b> of LIEF. If you find conflicts, compilation issues,
integration issues, or you think that it is a bad idea, <b>please let us know</b> before it becomes the default
interface to manage errors.</div><h3 id=the-rtti>The RTTI</h3><p>LIEF also relies on the RTTI information which includes calling functions like <code>typeid()</code> or <code>dynamic_cast&lt;>()</code>.
For instance, to check if a Mach-O&rsquo;s LoadCommand exists, the main <code>MachO::Binary</code> class calls at some point
this helper:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#cf222e>template</span><span style=color:#0550ae>&lt;</span><span style=color:#cf222e>class</span> <span style=color:#1f2328>T</span><span style=color:#0550ae>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#cf222e>bool</span> Binary<span style=color:#0550ae>::</span>has_command<span style=color:#1f2328>()</span> <span style=color:#cf222e>const</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>  <span style=color:#cf222e>static_assert</span><span style=color:#1f2328>(</span>std<span style=color:#0550ae>::</span>is_base_of<span style=color:#0550ae>&lt;</span>LoadCommand<span style=color:#1f2328>,</span> T<span style=color:#0550ae>&gt;::</span>value<span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>                <span style=color:#0a3069>&#34;Require inheritance from &#39;LoadCommand&#39;&#34;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>  <span style=color:#cf222e>const</span> <span style=color:#cf222e>auto</span> it_cmd <span style=color:#0550ae>=</span> std<span style=color:#0550ae>::</span>find_if<span style=color:#1f2328>(</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>      std<span style=color:#0550ae>::</span>begin<span style=color:#1f2328>(</span>commands_<span style=color:#1f2328>),</span> std<span style=color:#0550ae>::</span>end<span style=color:#1f2328>(</span>commands_<span style=color:#1f2328>),</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>      <span style=color:#1f2328>[]</span> <span style=color:#1f2328>(</span><span style=color:#cf222e>const</span> LoadCommand<span style=color:#0550ae>*</span> command<span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>        <span style=color:#cf222e>return</span> <span style=color:#6639ba>typeid</span><span style=color:#1f2328>(</span>T<span style=color:#1f2328>)</span> <span style=color:#0550ae>==</span> <span style=color:#cf222e>typeid</span><span style=color:#1f2328>(</span><span style=color:#0550ae>*</span>command<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>      <span style=color:#1f2328>});</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>  <span style=color:#cf222e>return</span> it_cmd <span style=color:#0550ae>!=</span> std<span style=color:#0550ae>::</span>end<span style=color:#1f2328>(</span>commands_<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p>This code generates extra data for the RTTI information of the LoadCommand objects which can be perfectly fine.
Actually, this RTTI information is redundant as the type of a Mach-O&rsquo;s LoadCommand is already stored in the class
itself:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#cf222e>class</span> <span style=color:#1f2328>LoadCommand</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>  <span style=color:#1f2328>...</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>  <span style=color:#cf222e>private</span><span style=color:#0550ae>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>  LOAD_COMMAND_TYPES command_<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#1f2328>};</span>
</span></span></code></pre></div><p>So instead of having these redundant RTTI, we implemented a LLVM-like RTTI<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> based on <code>classof()</code>
and that uses the already present <code>command_</code> attribute.
In the end, the previous <code>has_command()</code> can be updated as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#cf222e>template</span><span style=color:#0550ae>&lt;</span><span style=color:#cf222e>class</span> <span style=color:#1f2328>T</span><span style=color:#0550ae>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#cf222e>bool</span> Binary<span style=color:#0550ae>::</span>has_command<span style=color:#1f2328>()</span> <span style=color:#cf222e>const</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>  <span style=color:#cf222e>static_assert</span><span style=color:#1f2328>(</span>std<span style=color:#0550ae>::</span>is_base_of<span style=color:#0550ae>&lt;</span>LoadCommand<span style=color:#1f2328>,</span> T<span style=color:#0550ae>&gt;::</span>value<span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>                <span style=color:#0a3069>&#34;Require inheritance from &#39;LoadCommand&#39;&#34;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>  <span style=color:#cf222e>const</span> <span style=color:#cf222e>auto</span> it_cmd <span style=color:#0550ae>=</span> std<span style=color:#0550ae>::</span>find_if<span style=color:#1f2328>(</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>      std<span style=color:#0550ae>::</span>begin<span style=color:#1f2328>(</span>commands_<span style=color:#1f2328>),</span> std<span style=color:#0550ae>::</span>end<span style=color:#1f2328>(</span>commands_<span style=color:#1f2328>),</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>      <span style=color:#1f2328>[]</span> <span style=color:#1f2328>(</span><span style=color:#cf222e>const</span> LoadCommand<span style=color:#0550ae>*</span> command<span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>        <span style=color:#cf222e>return</span> T<span style=color:#0550ae>::</span>classof<span style=color:#1f2328>(</span>command<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>      <span style=color:#1f2328>});</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>  <span style=color:#cf222e>return</span> it_cmd <span style=color:#0550ae>!=</span> std<span style=color:#0550ae>::</span>end<span style=color:#1f2328>(</span>commands_<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p>We applied this pattern for the LIEF&rsquo;s object where <code>typeid</code> was present and as a result,
we managed to completely remove this function as it was redundant with an existing attribute.</p><h2>} catch (const std::length_error&) {</h2><br><p>We welcome feedback on these changes &ndash; whether positive or negative &ndash; as it impacts the public API.</p><p>Thank you for reading!</p><h2>}</h2><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>See the section <a href=https://lief-project.github.io/doc/latest/error_handling.html>Error Handling</a>
of the documentation for more details.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>It still keeps the public headers compliant with C++11&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://llvm.org/docs/HowToSetUpLLVMStyleRTTI.html>https://llvm.org/docs/HowToSetUpLLVMStyleRTTI.html</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class="d-flex flex-column flex-sm-row align-items-center border-top border-gray-200 mt-6 py-5"><div class=media><div class="avatar mr-4"><img src=https://lief.re/img/avatar/romain.png class="avatar-image rounded-circle" alt=Avatar></div><div class=media-body><span class="text-darkblue text-uppercase-xs font-weight-bolder"><a href=https://www.romainthomas.fr target=_blank>Romain Thomas
</a></span><span class="text-muted font-size-sm d-block">Posted on February 13, 2022</span></div></div></div></div></div></div></section><footer class="footer footer-dark bg-dark"><div class="container text-center"><div class=row><div class="col-12 col-md"><h6 class="footer-header mb-4 pb-md-2">LIEF</h6><a href=https://github.com/lief-project/LIEF class=footer-link>Github
</a><a href=https://lief.re//download class="footer-link mt-2">Download
</a><a href=https://lief.re//doc/latest class="footer-link mt-2">Documentation</a></div><div class="col-12 col-md mt-5 mt-md-0"><h6 class="footer-header mb-4 pb-md-2">Quarkslab</h6><a href=https://blog.quarkslab.com/ class=footer-link>Blog
</a><a href=https://quarkslab.com/ class="footer-link mt-2">Website</a></div><div class="col-12 col-md mt-5 mt-md-0"><h6 class="footer-header mb-4 pb-md-2">Other Tools</h6><a href=https://qbdi.quarkslab.com/ class=footer-link>QBDI
</a><a href=https://triton.quarkslab.com/ class="footer-link mt-2">Triton</a></div></div><div class="d-flex justify-content-center mt-6"><a href=https://infosec.exchange/@rh0main class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-mastodon fa-lg"></i>
</span></a><a href=https://x.com/lief_project class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-x-twitter fa-lg"></i>
</span></a><a href=https://crates.io/crates/lief class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-rust fa-lg"></i>
</span></a><a href=https://pypi.org/project/lief/ class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-python fa-lg"></i>
</span></a><a href=https://github.com/lief-project/LIEF class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-github fa-lg"></i>
</span></a><a href=https://discord.gg/jGQtyAYChJ class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-discord fa-lg"></i></span></a></div></div></footer><script src=https://lief.re//js/vendor.min.js></script><script src=https://lief.re//js/theme.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload=renderMathInElement(document.body)></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js></script><script>$("#copy").tooltip({trigger:"click",placement:"bottom"});function setTooltip(e){$("#copy").tooltip("hide").attr("data-original-title",e).tooltip("show")}function hideTooltip(){setTimeout(function(){$("#copy").tooltip("hide")},1e3)}var clipboard=new ClipboardJS("#copy");clipboard.on("success",function(){setTooltip("Copied!"),hideTooltip()}),clipboard.on("error",function(){setTooltip("Failed!"),hideTooltip()})</script></body></html>