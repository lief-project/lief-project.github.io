<!doctype html><html lang=en-us prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=description content><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=google-site-verification content="OcWjYs0PdsQZtqu1ms5QSr5FplDf_t5GEneU---wWzM"><meta name=description content="This blog post describes updates and enhancements in the support of PE binaries by LIEF"><meta name=keywords content><meta property="og:type" content="article"><meta property="og:description" content="This blog post describes updates and enhancements in the support of PE binaries by LIEF"><meta property="og:title" content="PE Support Enhancements"><meta property="og:site_name" content="LIEF"><meta property="og:image" content="https://lief.re/blog/2025-02-16-arm64ec-pe-support/featured.webp"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content><meta property="og:image:height" content><meta property="og:url" content="https://lief.re/blog/2025-02-16-arm64ec-pe-support/"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2025-02-16
"><meta property="article:modified_time" content="2025-02-16
"><meta name=twitter:card content="summary"><meta name=twitter:site content="@lief_project"><meta name=twitter:creator content="@lief_project"><meta name=twitter:title content="PE Support Enhancements | LIEF"><meta name=twitter:description content="This blog post describes updates and enhancements in the support of PE binaries by LIEF | LIEF"><meta property="twitter:image:src" content="https://lief.re/blog/2025-02-16-arm64ec-pe-support/featured.webp"><meta name=twitter:domain content="https://lief.re/blog/2025-02-16-arm64ec-pe-support/"><title>LIEF</title>
<link rel=canonical href=https://lief.re/blog/2025-02-16-arm64ec-pe-support/><link rel=stylesheet type=text/css href=https://lief.re//css/theme.min.css><link rel=stylesheet type=text/css href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css><link rel=stylesheet type=text/css href=https://lief.re//css/vendor.min.css><link rel=stylesheet type=text/css href=https://lief.re//css/termynal.css><link rel=stylesheet type=text/css href=https://lief.re//css/animate.css><link rel=apple-touch-icon href=https://lief.re//img/favicon.ico type=image/x-icon><link rel="shortcut icon" href=https://lief.re//img/favicon.ico type=image/x-icon><link rel=icon href=https://lief.re//img/favicon.ico type=image/x-icon><style></style></head><body class=bg-light><nav class="navbar navbar-expand-lg navbar-light bg-light position-absolute w-100 bg-white" role=navigation><div class="container position-relative"><a href=https://lief.re/ class=navbar-brand>LIEF</a>
<button class=navbar-toggler data-toggle=collapse data-target=#navbar-collapse>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse justify-content-end mt-2 mt-lg-0" id=navbar-collapse><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://lief.re/><i class="fa-solid fa-house mr-3"></i>
Home</a></li><li class=nav-item><a class=nav-link href=https://lief.re/blog><i class="fa-solid fa-rss mr-3"></i>
Blog</a></li><li class=nav-item><a class=nav-link href=https://lief.re/download><i class="fa-solid fa-download mr-3"></i>
Download</a></li><li class="nav-item dropdown"><a href=https://lief.re/doc/latest class="nav-link dropdown-toggle" data-toggle=dropdown><i class="fa-solid fa-book mr-3"></i>
Documentation</a><div class="dropdown-menu px-4" role=menu><a class="dropdown-item d-flex align-items-center border-bottom border-gray-100 p-2" href=https://lief.re/doc/latest/><span class="svg-icon text-purple mr-3"><svg width="512" height="512" viewBox="0 0 512 512"><title>ionicons-v5-m</title><path d="M160 389a20.91 20.91.0 01-13.82-5.2l-128-112a21 21 0 010-31.6l128-112a21 21 0 0127.66 31.61L63.89 256l109.94 96.19A21 21 0 01160 389z"/><path d="M352 389a21 21 0 01-13.84-36.81L448.11 256 338.17 159.81a21 21 0 0127.66-31.61l128 112a21 21 0 010 31.6l-128 112A20.89 20.89.0 01352 389z"/></svg>
</span><span><p class=mb-0>API
<span class="badge badge-pastel-success font-weight-bold pt-2 ml-1">Latest</span></p><span class=text-secondary>Sphinx & Doxygen API documentation</span>
</span></a><a class="dropdown-item d-flex align-items-center border-bottom border-gray-100 p-2" href=https://lief.re/doc/stable/><span class="svg-icon text-purple mr-3"><svg width="512" height="512" viewBox="0 0 512 512"><title>ionicons-v5-m</title><path d="M160 389a20.91 20.91.0 01-13.82-5.2l-128-112a21 21 0 010-31.6l128-112a21 21 0 0127.66 31.61L63.89 256l109.94 96.19A21 21 0 01160 389z"/><path d="M352 389a21 21 0 01-13.84-36.81L448.11 256 338.17 159.81a21 21 0 0127.66-31.61l128 112a21 21 0 010 31.6l-128 112A20.89 20.89.0 01352 389z"/></svg>
</span><span><p class=mb-0>API
<span class="badge badge-pastel-primary font-weight-bold pt-2 ml-1">Stable</span></p><span class=text-secondary>Sphinx & Doxygen API documentation</span>
</span></a><a class="dropdown-item d-flex align-items-center border-bottom border-gray-100 p-2" href=https://lief.re/doc/latest/changelog.html><span class="svg-icon text-purple mr-3"><svg width="512" height="512" viewBox="0 0 512 512"><title>ionicons-v5-j</title><path d="M256 256s-48-96-126-96c-54.12.0-98 43-98 96s43.88 96 98 96c30 0 56.45-13.18 78-32" style="fill:none;stroke:#000;stroke-linecap:round;stroke-miterlimit:10;stroke-width:48px"/><path d="M256 256s48 96 126 96c54.12.0 98-43 98-96s-43.88-96-98-96c-29.37.0-56.66 13.75-78 32" style="fill:none;stroke:#000;stroke-linecap:round;stroke-miterlimit:10;stroke-width:48px"/></svg>
</span><span><p class=mb-0>Changelog</p><span class=text-secondary>See all updates</span></span></a></div></li><li class=nav-item><a class=nav-link href=https://lief.re/about><i class="fa-solid fa-bars-staggered mr-3"></i>
About</a></li><li class="nav-item ml-lg-3 mt-3 mt-lg-0"><a class="hover-lift-light mt-1" href=https://github.com/lief-project/LIEF target=_blank><i class="fab fa-2x fa-github text-darkblue"></i></a></li><li class="nav-item ml-lg-3 mt-3 mt-lg-0"><a class="hover-lift-light mt-1" href=https://discord.gg/jGQtyAYChJ target=_blank><i class="fab fa-2x fa-discord text-darkblue mr-3"></i></a></li><li class="nav-item ml-lg-3 mt-3 mt-lg-0"><a href=https://github.com/sponsors/lief-project/ class="btn btn-outline-pink" target=_blank><i class="fa-solid fa-heart mr-3"></i> Sponsor</a></li></ul></div></div></nav><div class="h-200 h-md-250 bg-light"></div><section class="bg-light pb-8"><div class="container fx-fade-up"><div class="row justify-content-center"><div class="col-lg-12 bg-white shadow-light-lg rounded py-5 px-4 px-md-7 mt-n6"><div class="avatar d-block mx-auto mt-n6 relative-top--7"><a href=https://www.romainthomas.fr target=_blank><img src=https://lief.re/img/avatar/romain.png class="rounded-circle avatar-image shadow" alt=Avatar></a></div><h2 class="text-center font-weight-normal mt-4">PE Support Enhancements</h2><div class="text-center text-muted font-size-sm mt-3"><span class=mr-3><span class="svg-icon svg-icon-sm text-muted relative-top--1 mr-1"><svg width="512" height="512" viewBox="0 0 512 512"><title>ionicons-v5-k</title><polygon points="364.13 125.25 87 403 64 448 108.99 425 386.75 147.87 364.13 125.25" style="fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/><path d="M420.69 68.69 398.07 91.31l22.62 22.63 22.62-22.63a16 16 0 000-22.62h0a16 16 0 00-22.62.0z" style="fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/></svg>
</span><a href=https://www.romainthomas.fr target=_blank>Romain Thomas </a></span><span class=ml-3><i class="far fa-calendar fa-xs mr-1 relative-top--1"></i>
February 16, 2025</span></div><img src=https://lief.re//img/waves.png class="d-block mx-auto mt-4 mb-5" alt=Wave><div class=text-dark><center><b>I'm pleased to share that LIEF's PE support has been significantly improved on
both aspects: parsing and writing.</b><br><br></center><p><img src=./featured.webp alt="Featuring Image"></p><h2 id=parsing-improvements>Parsing Improvements</h2><p>One of the significant updates in LIEF is the enhanced processing of the <code>IMAGE_LOAD_CONFIG_DIRECTORY</code>
which now includes a detailed parsing of the underlying structures it references.</p><p>For instance, the <em>Dynamic Value Relocation Table</em><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> is now fully
supported and can be accessed through the Python, C++, and Rust APIs:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#cf222e>import</span> <span style=color:#24292e>lief</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>pe <span style=color:#0550ae>=</span> lief<span style=color:#0550ae>.</span>PE<span style=color:#0550ae>.</span>parse<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;win11_arm64x_Windows.Media.Protection.PlayReady.dll&#34;</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>dyn_reloc_table <span style=color:#0550ae>=</span> pe<span style=color:#0550ae>.</span>load_configuration<span style=color:#0550ae>.</span>dynamic_relocations
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#cf222e>for</span> r <span style=color:#0550ae>in</span> dyn_reloc_table<span style=color:#1f2328>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>    <span style=color:#6639ba>print</span><span style=color:#1f2328>(</span>r<span style=color:#1f2328>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>Dynamic Value Relocation Table (version: 1)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>Symbol VA: 0x0000000000000006 (RELOCATION_ARM64X)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>Fixup RVAs (ARM64X)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>  [0000] RVA 0x0000010c, 2 bytes, target value 64:86
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>  [0001] RVA 0x00000130, 4 bytes, target value d0:bc:57:00
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>  [0002] RVA 0x00000190, 4 bytes, target value 30:22:d8:00
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>  [0003] RVA 0x00000194, 4 bytes, target value 30:01:00:00
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>  ...
</span></span></code></pre></div><p>All the structures involved in these dynamic relocations can be accessed through
an API, including support for special relocations:</p><ul><li><code>IMAGE_DYNAMIC_RELOCATION_ARM64X</code></li><li><code>IMAGE_DYNAMIC_RELOCATION_FUNCTION_OVERRIDE</code></li><li><code>IMAGE_DYNAMIC_RELOCATION_ARM64_KERNEL_IMPORT_CALL_TRANSFER</code></li><li><code>IMAGE_DYNAMIC_RELOCATION_GUARD_IMPORT_CONTROL_TRANSFER</code></li></ul><p>With the introduction of this new dynamic relocation support, LIEF can now offer
a <strong>relocated view</strong> of the ARM64EC binary that is embedded within an ARM64X binary.
To achieve this, simply parse the ARM64X PE binary with all options enabled.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#cf222e>let</span><span style=color:#fff> </span>pe<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>lief::pe::Binary::parse_with_config<span style=color:#1f2328>(</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#fff>    </span><span style=color:#0a3069>&#34;win11_arm64x_Windows.Media.Protection.PlayReady.dll&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#fff>    </span>lief::pe::ParserConfig::with_all_options<span style=color:#1f2328>(),</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#fff></span><span style=color:#1f2328>).</span>unwrap<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#fff></span><span style=color:#cf222e>if</span><span style=color:#fff> </span><span style=color:#cf222e>let</span><span style=color:#fff> </span><span style=color:#6639ba>Some</span><span style=color:#1f2328>(</span>nested_arm64ec<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>pe<span style=color:#1f2328>.</span>nested_pe_binary<span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#fff>  </span>println!<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;</span><span style=color:#0a3069>{:?}</span><span style=color:#0a3069>&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>nested_arm64ec<span style=color:#1f2328>.</span>header<span style=color:#1f2328>());</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><p>or in Python:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>pe<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>lief<span style=color:#1f2328>.</span><span style=color:#0550ae>PE</span><span style=color:#1f2328>.</span>parse<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;win11_arm64x_Windows.Media.Protection.PlayReady.dll&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#fff>                   </span>lief<span style=color:#1f2328>.</span><span style=color:#0550ae>PE</span><span style=color:#1f2328>.</span>ParserConfig<span style=color:#1f2328>.</span>all<span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#fff></span><span style=color:#cf222e>if</span><span style=color:#fff> </span>nested_arm64ec<span style=color:#fff> </span>:<span style=color:#0550ae>=</span><span style=color:#fff> </span>pe<span style=color:#1f2328>.</span>nested_pe_binary:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    <span style=color:#1f2328>print</span><span style=color:#1f2328>(</span>nested_arm64ec<span style=color:#1f2328>.</span>header<span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>Signature:               50 45 00 00
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>Machine:                 AMD64
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>Number of sections:      19
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>Pointer to symbol table: 0x0
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>Number of symbols:       0
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>Size of optional header: 0xf0
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>Characteristics:         EXECUTABLE_IMAGE, LARGE_ADDRESS_AWARE, DLL
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>Timtestamp:              1966221527
</span></span></code></pre></div><div class="admonition danger"><p class=admonition-title>Parser Config</p><p>To maintain the performance of LIEF v0.17.0 in line with previous versions,
the parsing of nested ARM64EC binaries must be <b>explicitly</b> enabled during the <code>lief.PE.parse()</code>
operation (the default is false).</div><p>LIEF provides helper functions such as: <code>lief.PE.Binary.is_arm64x()</code> and <code>lief.PE.Binary.is_arm64ec()</code>
to determine whether a given PE is ARM64 emulation compatible (EC) or
if it&rsquo;s a <em>fat</em> ARM64X.</p><p>These helper functions rely on the CHPE metadata (Compiled Hybrid Portable Executable)
which is accessible through LIEF for both: ARM64/ARM64EC binaries and legacy x86 binaries
executed via WoW64:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#cf222e>import</span> <span style=color:#24292e>lief</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#57606a># ARM64 CHPE</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>pe <span style=color:#0550ae>=</span> lief<span style=color:#0550ae>.</span>PE<span style=color:#0550ae>.</span>parse<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;arm64x_ImagingEngine.dll&#34;</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>chpe<span style=color:#1f2328>:</span> lief<span style=color:#0550ae>.</span>PE<span style=color:#0550ae>.</span>CHPEMetadataARM64 <span style=color:#0550ae>=</span> pe<span style=color:#0550ae>.</span>load_configuration<span style=color:#0550ae>.</span>chpe_metadata
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6639ba>print</span><span style=color:#1f2328>(</span>chpe_metadata<span style=color:#0550ae>.</span>auxiliary_delay_import<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6639ba>print</span><span style=color:#1f2328>(</span>chpe_metadata<span style=color:#0550ae>.</span>code_ranges<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#57606a># x86/WoW64 CHPE</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>pe <span style=color:#0550ae>=</span> lief<span style=color:#0550ae>.</span>PE<span style=color:#0550ae>.</span>parse<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;Windows.Media.dll&#34;</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>chpe<span style=color:#1f2328>:</span> lief<span style=color:#0550ae>.</span>PE<span style=color:#0550ae>.</span>CHPEMetadataX86 <span style=color:#0550ae>=</span> pe<span style=color:#0550ae>.</span>load_configuration<span style=color:#0550ae>.</span>chpe_metadata
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#6639ba>print</span><span style=color:#1f2328>(</span>chpe_metadata<span style=color:#0550ae>.</span>compiler_iat_pointer<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#6639ba>print</span><span style=color:#1f2328>(</span>chpe_metadata<span style=color:#0550ae>.</span>wowa64_dispatch_ret_function_pointer<span style=color:#1f2328>)</span>
</span></span></code></pre></div><p>Furthermore, LIEF can now process (in-depth) exception information for x86-64 and
ARM64 binaries as well as COFF strings and COFF symbols that are still used by
some toolchains.</p><h2 id=writing-improvements>Writing Improvements</h2><p>As mentioned at the beginning of this blog post, LIEF&rsquo;s PE modification engine,
also named Builder, has been completely refactored
to enhance its reliability and consistency when modifying PE binaries.
To support this update, the documentation includes a dedicated section detailing
the types of modifications supported by LIEF and their limitations:</p><ul><li><a href=https://lief.re/doc/latest/formats/pe/modifications/imports.html>Imports Modification</a></li><li><a href=https://lief.re/doc/latest/formats/pe/modifications/resources.html>Resources Modification</a></li><li><a href=https://lief.re/doc/latest/formats/pe/modifications/tls.html>TLS Modification</a></li><li><a href=https://lief.re/doc/latest/formats/pe/modifications/debug.html>Debug Modification</a></li><li><a href=https://lief.re/doc/latest/formats/pe/modifications/exports.html>Exports Modification</a></li></ul><p>For instance, <a href=https://lief.re/doc/latest/formats/pe/modifications/imports.html>PE import modification</a>
has been completely redesigned to avoid using <em>trampolines</em>.</p><p><img src=./msvc_layout.webp alt="PE Import Table for MSVC Binaries"></p><p>Likewise, LIEF can now commit changes made to the export table.
This enables the creation of new exports that can be used to expose
reverse-engineered functions or to deceive disassemblers, as mentioned in
<a href=https://www.romainthomas.fr/publication/22-pst-the-poor-mans-obfuscator/>The Poor Man&rsquo;s Obfuscator</a></p><center><img src=./lief-bn-square.webp alt="BinaryNinja Result" style=width:30%></center><h1 id=binaryninja-arm64ec-support>BinaryNinja ARM64EC Support</h1><p>The ARM64EC ABI<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>, created by Microsoft, was developed to ease interoperability
between ARM64 and x86-64 architectures, particularly for parts of the code that
require emulation (EC = Emulation Compatible).
The specifications of this ABI have a somewhat counterintuitive aspect: the
targeted architecture indicated in the PE header is <code>AMD64</code>, while the majority
of the functions are compiled for ARM64.</p><p>Darek Mihocka, one of the authors of the ARM64EC ABI, details some of these
design choices in a great blog post<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> that also provides an
historical background about the support of new architectures in Windows.</p><p>Because the PE header specifies an x86_64 architecture, which does not accurately
reflect most of the functions compiled in the binary, many disassemblers become confused when
trying to analyze such a binary:</p><p><img src=./ida.webp alt></p><p><img src=./bn_a.webp alt></p><p>To address this incomplete support, I developed a BinaryNinja plugin designed to
identify additional functions and accurately determine the architecture for which
each function has been compiled.</p><p>For example, after using this plugin, we obtain a feature map in BinaryNinja showing
that a majority of the functions have been correctly recognized:</p><p><img src=./bn_b.webp alt></p><p>The plugin is written in Rust using both LIEF & BinaryNinja Rust bindings. This
also serves as an opportunity to evaluate the LIEF Rust API and its integration
into other projects.</p><p>First, we can get a LIEF PE instance from a <code>BinaryView</code> with:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>enhance_with_lief</span><span style=color:#1f2328>(</span>bv: <span style=color:#cf222e>&amp;</span><span style=color:#1f2328>BinaryView</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#fff>    </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>filename<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>bv<span style=color:#1f2328>.</span>file<span style=color:#1f2328>().</span>filename<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#fff>    </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>pe<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>lief::pe::Binary::parse_with_config<span style=color:#1f2328>(</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#fff>        </span>filename<span style=color:#1f2328>.</span>as_str<span style=color:#1f2328>(),</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#fff>        </span><span style=color:#57606a>// This is required to get access to the exceptions info that are used later
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#57606a></span><span style=color:#fff>        </span>lief::pe::ParserConfig::with_all_options<span style=color:#1f2328>(),</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#fff>    </span><span style=color:#1f2328>).</span>unwrap<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><div class="admonition danger"><p class=admonition-title>Memory Footprint</p><p>Memory-wise, parsing the PE loaded by BinaryNinja with LIEF is not ideal since
the same binary exists in memory twice: once for the BinaryNinja instance and once for the LIEF instance.
I think that the BinaryNinja team will enhance the support for ARM64EC binaries at some point,
so in the meantime this memory overhead is acceptable.</div><p>Once we have this instance, we can use the exceptions table as a source
of function addresses allowing BinaryNinja to begin disassembling the binary
from these addresses:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#cf222e>let</span><span style=color:#fff> </span>pe: <span style=color:#cf222e>&amp;</span><span style=color:#1f2328>lief</span>::pe::Binary<span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#fff></span><span style=color:#cf222e>let</span><span style=color:#fff> </span>bv: <span style=color:#cf222e>&amp;</span><span style=color:#1f2328>BinaryView</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#fff></span><span style=color:#cf222e>let</span><span style=color:#fff> </span>windows_arm64<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>Platform::by_name<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;windows-aarch64&#34;</span><span style=color:#1f2328>).</span>unwrap<span style=color:#1f2328>().</span>to_owned<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#fff></span><span style=color:#cf222e>let</span><span style=color:#fff> </span>windows_x64<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>Platform::by_name<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;windows-x86_64&#34;</span><span style=color:#1f2328>).</span>unwrap<span style=color:#1f2328>().</span>to_owned<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#fff></span><span style=color:#cf222e>let</span><span style=color:#fff> </span>imagebase<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>pe<span style=color:#1f2328>.</span>optional_header<span style=color:#1f2328>().</span>imagebase<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#fff></span><span style=color:#cf222e>for</span><span style=color:#fff> </span>exception<span style=color:#fff> </span><span style=color:#cf222e>in</span><span style=color:#fff> </span>pe<span style=color:#1f2328>.</span>exceptions<span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#fff>    </span><span style=color:#cf222e>match</span><span style=color:#fff> </span>exception<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#fff>        </span>lief::pe::RuntimeExceptionFunction::X86_64<span style=color:#1f2328>(</span>x64<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>=&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#fff>            </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>addr: <span style=color:#cf222e>u64</span> <span style=color:#0550ae>=</span><span style=color:#fff> </span>imagebase<span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>x64<span style=color:#1f2328>.</span>rva_start<span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#cf222e>as</span><span style=color:#fff> </span><span style=color:#cf222e>u64</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#fff>            </span>bv<span style=color:#1f2328>.</span>add_auto_function<span style=color:#1f2328>(</span><span style=color:#0550ae>&amp;</span>windows_x64<span style=color:#1f2328>,</span><span style=color:#fff> </span>addr<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#fff>        </span>lief::pe::RuntimeExceptionFunction::AArch64<span style=color:#1f2328>(</span>arm64<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>=&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#fff>            </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>addr: <span style=color:#cf222e>u64</span> <span style=color:#0550ae>=</span><span style=color:#fff> </span>imagebase<span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>arm64<span style=color:#1f2328>.</span>rva_start<span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#cf222e>as</span><span style=color:#fff> </span><span style=color:#cf222e>u64</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#fff>            </span>bv<span style=color:#1f2328>.</span>add_auto_function<span style=color:#1f2328>(</span><span style=color:#0550ae>&amp;</span>windows_arm64<span style=color:#1f2328>,</span><span style=color:#fff> </span>addr<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#fff></span>bv<span style=color:#1f2328>.</span>update_analysis<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span></code></pre></div><p>This code leads to the feature map shown in the screenshot above.
Although the algorithm is straightforward, it conceals an important aspect of the ARM64EC ABI:</p><p>The exceptions table referenced by the data directory at the index: <code>IMAGE_DIRECTORY_ENTRY_EXCEPTION</code>
points to the <strong>X86_64 table</strong>. To access the ARM64 exceptions table we need
to refer to the CHPE metadata:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#cf222e>let</span><span style=color:#fff> </span>loadconfig<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>pe<span style=color:#1f2328>.</span>load_configuration<span style=color:#1f2328>().</span>unwrap<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#fff></span><span style=color:#cf222e>if</span><span style=color:#fff> </span><span style=color:#cf222e>let</span><span style=color:#fff> </span><span style=color:#6639ba>Some</span><span style=color:#1f2328>(</span>lief::pe::CHPEMetadata::<span style=color:#0550ae>ARM64</span><span style=color:#1f2328>(</span>arm64<span style=color:#1f2328>))</span><span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>loadconfig<span style=color:#1f2328>.</span>chpe_metadata<span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#fff>    </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>arm64_exception_table_start<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>arm64<span style=color:#1f2328>.</span>extra_rfe_table<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#fff>    </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>arm64_exception_table_size<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>arm64<span style=color:#1f2328>.</span>extra_rfe_table_size<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#fff>    </span>println!<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;</span><span style=color:#0a3069>{:#x}</span><span style=color:#0a3069> (</span><span style=color:#0a3069>{}</span><span style=color:#0a3069> bytes)&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>arm64_exception_table_start<span style=color:#1f2328>,</span><span style=color:#fff> </span>arm64_exception_table_size<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><p>LIEF abstracts the processing of CHPEMetadata and provides an iterator that
outputs one of the following exceptions object:</p><ul><li><code>lief::pe::exception_x64::RuntimeFunction</code></li><li><code>lief::pe::exception_aarch64::RuntimeFunction</code></li></ul><p>You can find more details about the exception support by LIEF in the dedicated PE changelog: <a href=https://lief.re/doc/latest/changelog/pe-0-17-0.html#pe-0170-changelog>https://lief.re/doc/latest/changelog/pe-0-17-0.html#pe-0170-changelog</a></p><p>The source code for the BinaryNinja plugin is available on GitHub: <a href=https://github.com/lief-project/lief-binaryninja-arm64ec>lief-project/lief-binaryninja-arm64ec</a>.
It contains additional features, but the code should be read through the lens of
a proof of concept.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://denuvosoftwaresolutions.github.io/DVRT/dvrt.html>https://denuvosoftwaresolutions.github.io/DVRT/dvrt.html</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://learn.microsoft.com/en-us/windows/arm/arm64ec>https://learn.microsoft.com/en-us/windows/arm/arm64ec</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=http://www.emulators.com/docs/abc_arm64ec_explained.htm>http://www.emulators.com/docs/abc_arm64ec_explained.htm</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class="d-flex flex-column flex-sm-row align-items-center border-top border-gray-200 mt-6 py-5"><div class=media><div class="avatar mr-4"><img src=https://lief.re/img/avatar/romain.png class="avatar-image rounded-circle" alt=Avatar></div><div class=media-body><span class="text-darkblue text-uppercase-xs font-weight-bolder"><a href=https://www.romainthomas.fr target=_blank>Romain Thomas
</a></span><span class="text-muted font-size-sm d-block">Posted on February 16, 2025</span></div></div></div></div></div></div></section><footer class="footer footer-dark bg-dark"><div class="container text-center"><div class=row><div class="col-12 col-md"><h6 class="footer-header mb-4 pb-md-2">LIEF</h6><a href=https://github.com/lief-project/LIEF class=footer-link>Github
</a><a href=https://lief.re//download class="footer-link mt-2">Download
</a><a href=https://lief.re//doc/latest class="footer-link mt-2">Documentation</a></div><div class="col-12 col-md mt-5 mt-md-0"><h6 class="footer-header mb-4 pb-md-2">Quarkslab</h6><a href=https://blog.quarkslab.com/ class=footer-link>Blog
</a><a href=https://quarkslab.com/ class="footer-link mt-2">Website</a></div><div class="col-12 col-md mt-5 mt-md-0"><h6 class="footer-header mb-4 pb-md-2">Other Tools</h6><a href=https://qbdi.quarkslab.com/ class=footer-link>QBDI
</a><a href=https://triton.quarkslab.com/ class="footer-link mt-2">Triton</a></div></div><div class="d-flex justify-content-center mt-6"><a href=https://infosec.exchange/@rh0main class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-mastodon fa-lg"></i>
</span></a><a href=https://x.com/lief_project class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-x-twitter fa-lg"></i>
</span></a><a href=https://crates.io/crates/lief class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-rust fa-lg"></i>
</span></a><a href=https://pypi.org/project/lief/ class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-python fa-lg"></i>
</span></a><a href=https://github.com/lief-project/LIEF class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-github fa-lg"></i>
</span></a><a href=https://discord.gg/jGQtyAYChJ class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-discord fa-lg"></i></span></a></div></div></footer><script src=https://lief.re//js/vendor.min.js></script><script src=https://lief.re//js/theme.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js></script><script>$("#copy").tooltip({trigger:"click",placement:"bottom"});function setTooltip(e){$("#copy").tooltip("hide").attr("data-original-title",e).tooltip("show")}function hideTooltip(){setTimeout(function(){$("#copy").tooltip("hide")},1e3)}var clipboard=new ClipboardJS("#copy");clipboard.on("success",function(){setTooltip("Copied!"),hideTooltip()}),clipboard.on("error",function(){setTooltip("Failed!"),hideTooltip()})</script></body></html>