<!doctype html><html lang=en-us prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=description content><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=google-site-verification content="OcWjYs0PdsQZtqu1ms5QSr5FplDf_t5GEneU---wWzM"><meta name=description content="LIEF 0.16.0 is out. This blog post highlights important changes and features"><meta name=keywords content><meta property="og:type" content="article"><meta property="og:description" content="LIEF 0.16.0 is out. This blog post highlights important changes and features"><meta property="og:title" content="LIEF v0.16.0"><meta property="og:site_name" content="LIEF"><meta property="og:image" content="https://lief.re/blog/2024-12-10-lief-0-16-0/featured.webp"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content><meta property="og:image:height" content><meta property="og:url" content="https://lief.re/blog/2024-12-10-lief-0-16-0/"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2024-12-10
"><meta property="article:modified_time" content="2024-12-10
"><meta name=twitter:card content="summary"><meta name=twitter:site content="@lief_project"><meta name=twitter:creator content="@lief_project"><meta name=twitter:title content="LIEF v0.16.0 | LIEF"><meta name=twitter:description content="LIEF 0.16.0 is out. This blog post highlights important changes and features | LIEF"><meta property="twitter:image:src" content="https://lief.re/blog/2024-12-10-lief-0-16-0/featured.webp"><meta name=twitter:domain content="https://lief.re/blog/2024-12-10-lief-0-16-0/"><title>LIEF</title>
<link rel=canonical href=https://lief.re/blog/2024-12-10-lief-0-16-0/><link rel=stylesheet type=text/css href=https://lief.re//css/theme.min.css><link rel=stylesheet type=text/css href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css><link rel=stylesheet type=text/css href=https://lief.re//css/vendor.min.css><link rel=stylesheet type=text/css href=https://lief.re//css/termynal.css><link rel=stylesheet type=text/css href=https://lief.re//css/animate.css><link rel=apple-touch-icon href=https://lief.re//img/favicon.ico type=image/x-icon><link rel="shortcut icon" href=https://lief.re//img/favicon.ico type=image/x-icon><link rel=icon href=https://lief.re//img/favicon.ico type=image/x-icon><style></style></head><body class=bg-light><nav class="navbar navbar-expand-lg navbar-light bg-light position-absolute w-100 bg-white" role=navigation><div class="container position-relative"><a href=https://lief.re/ class=navbar-brand>LIEF</a>
<button class=navbar-toggler data-toggle=collapse data-target=#navbar-collapse>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse justify-content-end mt-2 mt-lg-0" id=navbar-collapse><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://lief.re/><i class="fa-solid fa-house mr-3"></i>
Home</a></li><li class=nav-item><a class=nav-link href=https://lief.re/blog><i class="fa-solid fa-rss mr-3"></i>
Blog</a></li><li class=nav-item><a class=nav-link href=https://lief.re/download><i class="fa-solid fa-download mr-3"></i>
Download</a></li><li class="nav-item dropdown"><a href=https://lief.re/doc/latest class="nav-link dropdown-toggle" data-toggle=dropdown><i class="fa-solid fa-book mr-3"></i>
Documentation</a><div class="dropdown-menu px-4" role=menu><a class="dropdown-item d-flex align-items-center border-bottom border-gray-100 p-2" href=https://lief.re/doc/latest/><span class="svg-icon text-purple mr-3"><svg width="512" height="512" viewBox="0 0 512 512"><title>ionicons-v5-m</title><path d="M160 389a20.91 20.91.0 01-13.82-5.2l-128-112a21 21 0 010-31.6l128-112a21 21 0 0127.66 31.61L63.89 256l109.94 96.19A21 21 0 01160 389z"/><path d="M352 389a21 21 0 01-13.84-36.81L448.11 256 338.17 159.81a21 21 0 0127.66-31.61l128 112a21 21 0 010 31.6l-128 112A20.89 20.89.0 01352 389z"/></svg>
</span><span><p class=mb-0>API
<span class="badge badge-pastel-success font-weight-bold pt-2 ml-1">Latest</span></p><span class=text-secondary>Sphinx & Doxygen API documentation</span>
</span></a><a class="dropdown-item d-flex align-items-center border-bottom border-gray-100 p-2" href=https://lief.re/doc/stable/><span class="svg-icon text-purple mr-3"><svg width="512" height="512" viewBox="0 0 512 512"><title>ionicons-v5-m</title><path d="M160 389a20.91 20.91.0 01-13.82-5.2l-128-112a21 21 0 010-31.6l128-112a21 21 0 0127.66 31.61L63.89 256l109.94 96.19A21 21 0 01160 389z"/><path d="M352 389a21 21 0 01-13.84-36.81L448.11 256 338.17 159.81a21 21 0 0127.66-31.61l128 112a21 21 0 010 31.6l-128 112A20.89 20.89.0 01352 389z"/></svg>
</span><span><p class=mb-0>API
<span class="badge badge-pastel-primary font-weight-bold pt-2 ml-1">Stable</span></p><span class=text-secondary>Sphinx & Doxygen API documentation</span>
</span></a><a class="dropdown-item d-flex align-items-center border-bottom border-gray-100 p-2" href=https://lief.re/doc/latest/changelog.html><span class="svg-icon text-purple mr-3"><svg width="512" height="512" viewBox="0 0 512 512"><title>ionicons-v5-j</title><path d="M256 256s-48-96-126-96c-54.12.0-98 43-98 96s43.88 96 98 96c30 0 56.45-13.18 78-32" style="fill:none;stroke:#000;stroke-linecap:round;stroke-miterlimit:10;stroke-width:48px"/><path d="M256 256s48 96 126 96c54.12.0 98-43 98-96s-43.88-96-98-96c-29.37.0-56.66 13.75-78 32" style="fill:none;stroke:#000;stroke-linecap:round;stroke-miterlimit:10;stroke-width:48px"/></svg>
</span><span><p class=mb-0>Changelog</p><span class=text-secondary>See all updates</span></span></a></div></li><li class=nav-item><a class=nav-link href=https://lief.re/about><i class="fa-solid fa-bars-staggered mr-3"></i>
About</a></li><li class="nav-item ml-lg-3 mt-3 mt-lg-0"><a class="hover-lift-light mt-1" href=https://github.com/lief-project/LIEF target=_blank><i class="fab fa-2x fa-github text-darkblue"></i></a></li><li class="nav-item ml-lg-3 mt-3 mt-lg-0"><a class="hover-lift-light mt-1" href=https://discord.gg/jGQtyAYChJ target=_blank><i class="fab fa-2x fa-discord text-darkblue mr-3"></i></a></li><li class="nav-item ml-lg-3 mt-3 mt-lg-0"><a href=https://github.com/sponsors/lief-project/ class="btn btn-outline-pink" target=_blank><i class="fa-solid fa-heart mr-3"></i> Sponsor</a></li></ul></div></div></nav><div class="h-200 h-md-250 bg-light"></div><section class="bg-light pb-8"><div class="container fx-fade-up"><div class="row justify-content-center"><div class="col-lg-12 bg-white shadow-light-lg rounded py-5 px-4 px-md-7 mt-n6"><div class="avatar d-block mx-auto mt-n6 relative-top--7"><a href=https://www.romainthomas.fr target=_blank><img src=https://lief.re/img/avatar/romain.png class="rounded-circle avatar-image shadow" alt=Avatar></a></div><h2 class="text-center font-weight-normal mt-4">LIEF v0.16.0</h2><div class="text-center text-muted font-size-sm mt-3"><span class=mr-3><span class="svg-icon svg-icon-sm text-muted relative-top--1 mr-1"><svg width="512" height="512" viewBox="0 0 512 512"><title>ionicons-v5-k</title><polygon points="364.13 125.25 87 403 64 448 108.99 425 386.75 147.87 364.13 125.25" style="fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/><path d="M420.69 68.69 398.07 91.31l22.62 22.63 22.62-22.63a16 16 0 000-22.62h0a16 16 0 00-22.62.0z" style="fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/></svg>
</span><a href=https://www.romainthomas.fr target=_blank>Romain Thomas </a></span><span class=ml-3><i class="far fa-calendar fa-xs mr-1 relative-top--1"></i>
December 10, 2024</span></div><img src=https://lief.re//img/waves.png class="d-block mx-auto mt-4 mb-5" alt=Wave><div class=text-dark><h1 id=documentation>Documentation</h1><p>Documentation is an important aspect of LIEF and since the beginning of the
project, I have spent a decent amount of time keeping comprehensive and intuitive
documentation.</p><p>Usually, I don&rsquo;t include documentation updates in the changelog but in this case, I thought
it could be worth sharing this experience.</p><p>LIEF is written in C++ with bindings for Python and Rust. Originally, the
documentation was driven by languages API (isolated from each other) and
generated by Sphinx with the <a href=https://breathe.readthedocs.io/en/latest/>Breathe</a> plugin
to reference the C++ Doxygen domain.</p><p>Recently, Rust landed in the arena. Compared to Python and C++, the Rust language
embeds a built-in documentation engine to process and generate in-code
documentation into html pages.</p><p>Given the new Rust bindings and the Rust built-in documentation engine,
two questions emerged:</p><ol><li>Do we want to add (yet) another API page for Rust?</li><li>How do we reference Rust API in Sphinx?</li></ol><p>For the first point, I moved from a language-driven documentation structure
to a functionality-driven structure. This changes the way the documentation is consumed:
Instead of looking for format-specific API for a given language (e.g. Python) you
look first for what you want to do (ELF processing, Dyld shared cache parsing)
<strong>and then</strong> you access the language API you are interested in.</p><p>So instead of adding another Rust API reference page, the Rust API has been transparently
integrated with the new layout.</p><p><img src=./api-diff.webp alt="Documentation layout changes"></p><p>The second point has been a bit more tricky to approach. With a reverse engineering
background, I really value the <strong>cross-reference feature</strong> provided by Sphinx:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rst data-lang=rst><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>blah blah blah <span style=color:teal>:py:class:</span><span style=color:teal>`lief.ELF.Binary`</span> another blah: <span style=color:teal>:cpp:class:</span><span style=color:teal>`LIEF::ELF::Binary`</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span></code></pre></div><p>Python is a built-in domain supported by Sphinx and <a href=https://breathe.readthedocs.io/en/latest/>Breathe</a>
extension is doing the bridge between C++ Doxygen XML files and Sphinx.
For Rust, there are some attempts to create a bridge but I decided to take another path.
I created a Rust-sphinx domain that cross-references to the official or nightly Rust documentation.
Basically with this custom domain, the following cross-references redirect
to the official or nightly documentation:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rst data-lang=rst><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:teal>:rust:module:</span><span style=color:teal>`lief::assembly`</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=color:teal>:rust:enum:</span><span style=color:teal>`lief::assembly::Instructions`</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span></code></pre></div><p>Is translated into:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>https://lief-rs.s3.fr-par.scw.cloud/doc/latest/lief/assembly/index.html
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>https://lief-rs.s3.fr-par.scw.cloud/doc/latest/lief/assembly/enum.Instructions.html
</span></span></code></pre></div><p>By doing so, we can leverage Sphinx&rsquo;s cross-reference functionalities while
still keeping the built-in Rust documentation. In addition to this Rust-specific
domain, I created a <code>.. lief-api::</code> directive that can pack similar cross-language API
into a single block.</p><p>For instance, this directive:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rst data-lang=rst><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>.. <span style=color:#000;font-weight:700>lief-api</span>:: lief.Binary.disassemble()<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#a61717;background-color:#e3d2d2></span>    <span style=color:teal>:rust:method:</span><span style=color:teal>`lief::generic::Binary::disassemble [trait]`</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#a61717;background-color:#e3d2d2></span>    <span style=color:teal>:rust:method:</span><span style=color:teal>`lief::generic::Binary::disassemble_symbol [trait]`</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#a61717;background-color:#e3d2d2></span>    <span style=color:teal>:rust:method:</span><span style=color:teal>`lief::generic::Binary::disassemble_address [trait]`</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#a61717;background-color:#e3d2d2></span>    <span style=color:teal>:rust:method:</span><span style=color:teal>`lief::generic::Binary::disassemble_slice [trait]`</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#a61717;background-color:#e3d2d2></span>    <span style=color:teal>:cpp:func:</span><span style=color:teal>`LIEF::Binary::disassemble`</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#a61717;background-color:#e3d2d2></span>    <span style=color:teal>:py:meth:</span><span style=color:teal>`lief.Binary.disassemble`</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span><span style=color:#a61717;background-color:#e3d2d2></span>    <span style=color:teal>:py:meth:</span><span style=color:teal>`lief.Binary.disassemble_from_bytes`</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span></code></pre></div><p>Is rendered as:</p><p><img src=./rust-domain.webp alt="Documentation layout changes"></p><p>This allows us to refer the API for different languages without being too verbose and impacting
readability. Combined with Sphinx substitution, we can write:</p><pre tabindex=0><code>This is an example that cross-reference |lief-disassemble|

.. |lief-disassemble| lief-api:: lief.Binary.disassemble()

    :rust:method:`lief::generic::Binary::disassemble [trait]`
    :rust:method:`lief::generic::Binary::disassemble_symbol [trait]`
    :rust:method:`lief::generic::Binary::disassemble_address [trait]`
    :rust:method:`lief::generic::Binary::disassemble_slice [trait]`
    :cpp:func:`LIEF::Binary::disassemble`
    :py:meth:`lief.Binary.disassemble`
    :py:meth:`lief.Binary.disassemble_from_bytes`
</code></pre><p>You can go checking out this page <a href=https://lief.re/doc/latest/formats/pe/index.html>https://lief.re/doc/latest/formats/pe/index.html</a>
to see a concrete rendering of these changes.</p><h1 id=extended-features>Extended Features</h1><div class="admonition check"><p class=admonition-title>Public Release</p><p>The extended version is now publicly available at this address:
<a href=https://extended.lief.re target=_blank>https://extended.lief.re</a></div><h2 id=assembler--disassembler>Assembler & Disassembler</h2><p>Adding (or not adding) a disassembler in LIEF has been a long-standing question
and with the <a href=https://lief.re/doc/latest/extended/intro.html>extended</a> version,
I found a fair trade-off:</p><center><b>LIEF core focuses on executable formats, free
from any extra features that might have a significant impact on the build complexity or
library size.</b></center><br><p>On the other hand, LIEF extended provides additional functionalities that
require a more complex build pipeline and increase the binary size.
Among these extended functionalities, ther are a <a href=https://lief.re//doc/latest/extended/disassembler/index.html>disassembler</a> and
an <a href=https://lief.re//doc/latest/extended/assembler/index.html>assembler</a> based on the LLVM&rsquo;s MC layer.</p><p>The disassembling API is provided at different levels:</p><h4 id=liefbinary>LIEF::Binary</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#000;font-weight:700>import</span> <span style=color:#555>lief</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>pe <span style=color:#000;font-weight:700>=</span> lief<span style=color:#000;font-weight:700>.</span>PE<span style=color:#000;font-weight:700>.</span>parse(<span style=color:#d14>&#34;cmd.exe&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#000;font-weight:700>for</span> inst <span style=color:#000;font-weight:700>in</span> pe<span style=color:#000;font-weight:700>.</span>disassemble(<span style=color:#099>0x400000</span>):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#0086b3>print</span>(inst)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#998;font-style:italic># Instruction semantic</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#0086b3>print</span>(inst<span style=color:#000;font-weight:700>.</span>is_syscall)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#0086b3>print</span>(inst<span style=color:#000;font-weight:700>.</span>is_memory_access)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#0086b3>print</span>(inst<span style=color:#000;font-weight:700>.</span>is_call)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#998;font-style:italic># Instruction operands (for AArch64 and x86-64)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    <span style=color:#000;font-weight:700>if</span> <span style=color:#0086b3>isinstance</span>(inst, lief<span style=color:#000;font-weight:700>.</span>assembly<span style=color:#000;font-weight:700>.</span>aarch64<span style=color:#000;font-weight:700>.</span>Instruction):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>        <span style=color:#000;font-weight:700>for</span> idx, operand <span style=color:#000;font-weight:700>in</span> <span style=color:#0086b3>enumerate</span>(inst<span style=color:#000;font-weight:700>.</span>operands):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>            <span style=color:#000;font-weight:700>match</span> operand:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>              <span style=color:#000;font-weight:700>case</span> lief<span style=color:#000;font-weight:700>.</span>assembly<span style=color:#000;font-weight:700>.</span>aarch64<span style=color:#000;font-weight:700>.</span>operands<span style=color:#000;font-weight:700>.</span>Register():
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>                  <span style=color:#0086b3>print</span>(<span style=color:#d14>f</span><span style=color:#d14>&#34;OP[</span><span style=color:#d14>{</span>idx<span style=color:#d14>}</span><span style=color:#d14>] -- REG: </span><span style=color:#d14>{</span>operand<span style=color:#000;font-weight:700>.</span>value<span style=color:#d14>}</span><span style=color:#d14>&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>              <span style=color:#000;font-weight:700>case</span> lief<span style=color:#000;font-weight:700>.</span>assembly<span style=color:#000;font-weight:700>.</span>aarch64<span style=color:#000;font-weight:700>.</span>operands<span style=color:#000;font-weight:700>.</span>Memory():
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>                  <span style=color:#0086b3>print</span>(<span style=color:#d14>f</span><span style=color:#d14>&#34;OP[</span><span style=color:#d14>{</span>idx<span style=color:#d14>}</span><span style=color:#d14>] -- MEM: </span><span style=color:#d14>{</span>operand<span style=color:#000;font-weight:700>.</span>base<span style=color:#d14>}</span><span style=color:#d14> </span><span style=color:#d14>{</span>operand<span style=color:#000;font-weight:700>.</span>offset<span style=color:#d14>}</span><span style=color:#d14>&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>              <span style=color:#000;font-weight:700>case</span> lief<span style=color:#000;font-weight:700>.</span>assembly<span style=color:#000;font-weight:700>.</span>aarch64<span style=color:#000;font-weight:700>.</span>operands<span style=color:#000;font-weight:700>.</span>PCRelative():
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>                  <span style=color:#0086b3>print</span>(<span style=color:#d14>f</span><span style=color:#d14>&#34;OP[</span><span style=color:#d14>{</span>idx<span style=color:#d14>}</span><span style=color:#d14>] -- PCR: </span><span style=color:#d14>{</span>operand<span style=color:#000;font-weight:700>.</span>value<span style=color:#d14>}</span><span style=color:#d14>&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>              <span style=color:#000;font-weight:700>case</span> lief<span style=color:#000;font-weight:700>.</span>assembly<span style=color:#000;font-weight:700>.</span>aarch64<span style=color:#000;font-weight:700>.</span>operands<span style=color:#000;font-weight:700>.</span>Immediate():
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>                  <span style=color:#0086b3>print</span>(<span style=color:#d14>f</span><span style=color:#d14>&#34;OP[</span><span style=color:#d14>{</span>idx<span style=color:#d14>}</span><span style=color:#d14>] -- IMM: </span><span style=color:#d14>{</span>operand<span style=color:#000;font-weight:700>.</span>value<span style=color:#d14>}</span><span style=color:#d14>&#34;</span>)
</span></span></code></pre></div><h4 id=liefdwarffunction>LIEF::dwarf::Function</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#000;font-weight:700>import</span> <span style=color:#555>lief</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>elf <span style=color:#000;font-weight:700>=</span> lief<span style=color:#000;font-weight:700>.</span>ELF<span style=color:#000;font-weight:700>.</span>parse(<span style=color:#d14>&#34;my-dbg.elf&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>dwarf: lief<span style=color:#000;font-weight:700>.</span>dwarf<span style=color:#000;font-weight:700>.</span>DebugInfo <span style=color:#000;font-weight:700>=</span> elf<span style=color:#000;font-weight:700>.</span>debug_info
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>func: lief<span style=color:#000;font-weight:700>.</span>dwarf<span style=color:#000;font-weight:700>.</span>Function <span style=color:#000;font-weight:700>=</span> dwarf<span style=color:#000;font-weight:700>.</span>find_function(<span style=color:#d14>&#34;my_debug_function&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#000;font-weight:700>for</span> inst <span style=color:#000;font-weight:700>in</span> func<span style=color:#000;font-weight:700>.</span>instructions:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>    <span style=color:#0086b3>print</span>(inst)
</span></span></code></pre></div><h4 id=liefdscdyldsharedcache>LIEF::dsc::DyldSharedCache</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#000;font-weight:700>import</span> <span style=color:#555>lief</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>cache <span style=color:#000;font-weight:700>=</span> lief<span style=color:#000;font-weight:700>.</span>dsc<span style=color:#000;font-weight:700>.</span>load(<span style=color:#d14>&#34;ios-18/&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#000;font-weight:700>for</span> inst <span style=color:#000;font-weight:700>in</span> cache<span style=color:#000;font-weight:700>.</span>disassemble(<span style=color:#099>0x1886f4a44</span>):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    <span style=color:#0086b3>print</span>(inst)
</span></span></code></pre></div><p>In terms of implementation, the disassembler wraps a lazy iterator that evaluates/disassembles
an instruction <strong>only</strong> when the iterator is processed. It means that you don&rsquo;t pay any overhead
until you access the iterator&rsquo;s value:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span># O(0)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>inst = macho.disassemble(0x400000)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>inst = macho.disassemble(0x400000)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span># O(10)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>for _ in range(10):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>  next(inst)
</span></span></code></pre></div><p>The <code>.end()</code> sentinel of the iterator is based on two properties:</p><ol><li>Either a range is specified (e.g. <code>macho.disassemble(0x400000, /*size*/0x1000)</code>)
and the iterator past the end of the range.</li><li>The instruction can&rsquo;t be disassembled.</li></ol><p>This kind of sentinel allows us to use this API: <code>macho.disassemble(0x400000)</code> which
will disassemble (lazily) instructions at the address <code>0x400000</code> until it fails.</p><div class="admonition note"><p class=admonition-title>C++ & Rust & Python</p><p>The disassembler/assembler API is uniformly available in Rust, C++, and Python.</div><h3 id=capstone-nyxstone>Capstone? Nyxstone?</h3><p><a href=https://lief.re/doc/latest/extended/disassembler/index.html#technical-details>As stated in the documentation</a>
the major design difference with <a href=https://www.capstone-engine.org/>Capstone</a> is that LIEF uses a mainstream version of LLVM
with limited patches<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> on the MC layer (the current version is based on LLVM <code>19.1.2</code>).</p><p>The design difference with <a href=https://github.com/emproof-com/nyxstone>Nyxstone</a> is that
LLVM is hidden from the public API which means that it does not require to have
an LLVM version pre-install on the system. Moreover, it exposes opcodes and
control-flow/semantic information about the instructions.</p><p><strong>On the other hand, LIEF does not provide a standalone API to disassemble
arbitrary instructions. The disassembler engine is bound to the object from which
the API is exposed.</strong></p><h3 id=assembler>Assembler</h3><p>In association with a disassembler, LIEF exposes a (basic) assembly API that allows
generating <strong>and patching</strong> instructions:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#000;font-weight:700>import</span> <span style=color:#555>lief</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>elf <span style=color:#000;font-weight:700>=</span> lief<span style=color:#000;font-weight:700>.</span>ELF<span style=color:#000;font-weight:700>.</span>parse(<span style=color:#d14>&#34;my-android-obfuscated.so&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>text <span style=color:#000;font-weight:700>=</span> elf<span style=color:#000;font-weight:700>.</span>get_section(<span style=color:#d14>&#34;.text&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#998;font-style:italic># Disassembler</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>syscall <span style=color:#000;font-weight:700>=</span> [inst <span style=color:#000;font-weight:700>for</span> inst <span style=color:#000;font-weight:700>in</span> elf<span style=color:#000;font-weight:700>.</span>disassemble(<span style=color:#0086b3>bytes</span>(text)) <span style=color:#000;font-weight:700>if</span> inst<span style=color:#000;font-weight:700>.</span>is_syscall]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#998;font-style:italic># Assembler</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#000;font-weight:700>for</span> syscall_inst <span style=color:#000;font-weight:700>in</span> syscall:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    new_bytes <span style=color:#000;font-weight:700>=</span> elf<span style=color:#000;font-weight:700>.</span>assemble(syscall_inst<span style=color:#000;font-weight:700>.</span>address, <span style=color:#d14>&#34;nop;&#34;</span>) <span style=color:#998;font-style:italic># Assemble AND patch</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#0086b3>print</span>(new_bytes<span style=color:#000;font-weight:700>.</span>hex(<span style=color:#d14>&#34;, &#34;</span>))
</span></span></code></pre></div><div class="admonition warning"><p class=admonition-title>Warning</p><p>In this current version, the assembler is working <i>pretty</i> well for
x86/x86_64 and AArch64 but might break on other architectures.
In addition, <code>llvm::MCFixup</code><b> are not supported.</b></div><p>This can be used to patch LIEF&rsquo;s binary object directly at the assembly level.
I have some plans to provide LIEF Binary context to the assembly engine such as if the binary
defines a function <code>call_me()</code> that is either exported or present in the debug info,
users would be able to leverage this function at the assembly level:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#000;font-weight:700>fn</span> <span style=color:#900;font-weight:700>patch_with_context</span>(macho: <span style=color:#000;font-weight:700>&amp;</span><span style=color:#458;font-weight:700>mut</span><span style=color:#bbb> </span>lief::macho::Binary)<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#bbb>  </span>macho.assemble(<span style=color:#099>0x140000090</span>,<span style=color:#bbb> </span><span style=color:#d14>r</span><span style=color:#d14>#&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#d14>    adrp x0, call_me;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#d14>    add x0, x0, :lo12:call_me;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#d14>    mov x1, 0x90;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#d14>    str x1, [x0];
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#d14>  &#34;#</span>r);<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><p>And LIEF would handle the relocation/resolution process to instruct LLVM about
the location and the definition of <code>call_me</code>.</p><div class="admonition note"><p class=admonition-title>C++ & Rust & Python</p><p>The disassembler/assembler API is seamlessly available in Rust, C++, and Python :)</div><h2 id=dyld-shared-cache>Dyld Shared Cache</h2><p>Initial support for processing Apple&rsquo;s Dyld shared cache with LIEF has been released
along with an API to <strong>deoptimize</strong> in-cache Dylib. The API looks like this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#000;font-weight:700>import</span> <span style=color:#555>lief</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>cache <span style=color:#000;font-weight:700>=</span> lief<span style=color:#000;font-weight:700>.</span>dsc<span style=color:#000;font-weight:700>.</span>load(<span style=color:#d14>&#34;ios-18.1/&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#000;font-weight:700>for</span> dylib <span style=color:#000;font-weight:700>in</span> cache<span style=color:#000;font-weight:700>.</span>libraries:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    <span style=color:#0086b3>print</span>(<span style=color:#d14>f</span><span style=color:#d14>&#34;0x</span><span style=color:#d14>{</span>dylib<span style=color:#000;font-weight:700>.</span>address<span style=color:#d14>:</span><span style=color:#d14>016x</span><span style=color:#d14>}</span><span style=color:#d14> </span><span style=color:#d14>{</span>dylib<span style=color:#000;font-weight:700>.</span>path<span style=color:#d14>}</span><span style=color:#d14>&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    <span style=color:#998;font-style:italic># Extract the dylib as a regular lief.MachO.Binary</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>    macho: lief<span style=color:#000;font-weight:700>.</span>MachO<span style=color:#000;font-weight:700>.</span>Binary <span style=color:#000;font-weight:700>=</span> dylib<span style=color:#000;font-weight:700>.</span>get()
</span></span></code></pre></div><div class="admonition warning"><p class=admonition-title>Warning</p><p>Please note that the deoptimization feature is not working well on all the shared cache libraries.
This support is going to be improved over time.</div><p>One could also use this API to diff two shared caches:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#000;font-weight:700>use</span><span style=color:#bbb> </span>lief;<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>let</span><span style=color:#bbb> </span>ios_17<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>lief::dsc::load_from_path(<span style=color:#d14>&#34;ios-17.7.1&#34;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>let</span><span style=color:#bbb> </span>ios_18<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>lief::dsc::load_from_path(<span style=color:#d14>&#34;ios-18.1.1&#34;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>let</span><span style=color:#bbb> </span>libraries_17: <span style=color:#458;font-weight:700>HashSet</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0086b3>String</span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>ios_17.libraries()<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#bbb>                                          </span>.map(<span style=color:#000;font-weight:700>|</span>lib<span style=color:#000;font-weight:700>|</span><span style=color:#bbb> </span>lib.path())<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#bbb>                                          </span>.collect();<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>let</span><span style=color:#bbb> </span>libraries_18: <span style=color:#458;font-weight:700>HashSet</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0086b3>String</span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>ios_18.libraries()<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#bbb>                                          </span>.map(<span style=color:#000;font-weight:700>|</span>lib<span style=color:#000;font-weight:700>|</span><span style=color:#bbb> </span>lib.path())<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#bbb>                                          </span>.collect();<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#bbb></span>println!(<span style=color:#d14>&#34;</span><span style=color:#d14>{:?}</span><span style=color:#d14>&#34;</span>,<span style=color:#bbb> </span>libraries_17.symmetric_difference(<span style=color:#000;font-weight:700>&amp;</span>libraries_18))<span style=color:#bbb>
</span></span></span></code></pre></div><h1 id=rust>Rust</h1><p>Rust bindings got their first <strong>mutable</strong> functions which are listed in the
<a href=https://lief.re/doc/latest/changelog.html>changelog</a>. These mutable functions
are limited but they allow us to make basic modifications like adding a library
or patching assembly code:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#000;font-weight:700>fn</span> <span style=color:#900;font-weight:700>add_library</span>(elf: <span style=color:#000;font-weight:700>&amp;</span><span style=color:#458;font-weight:700>mut</span><span style=color:#bbb> </span>lief::elf::Binary)<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#bbb>  </span>elf.add_library(<span style=color:#d14>&#34;libtest.so&#34;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#bbb>  </span>elf.write(<span style=color:#d14>&#34;patched.elf&#34;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#000;font-weight:700>fn</span> <span style=color:#900;font-weight:700>patch_asm</span>(elf: <span style=color:#000;font-weight:700>&amp;</span><span style=color:#458;font-weight:700>mut</span><span style=color:#bbb> </span>lief::macho::Binary)<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#bbb>  </span>macho.assemble(<span style=color:#099>0x100004090</span>,<span style=color:#bbb> </span><span style=color:#d14>r</span><span style=color:#d14>#&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#d14>    mov x0, x16;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#d14>    br x0;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#d14>  &#34;#</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#bbb>  </span>macho.write(<span style=color:#d14>&#34;patched.macho&#34;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><p>In addition, the support for the <code>x86_64-unknown-linux-musl</code> target triple is now available
and the minimal GLIBC version for <code>x86_64-unknown-linux-gnu</code> has been lowered to
<code>2.28</code>. It means that Linux Rust bindings can now run on Debian 10, Ubuntu 19.10, &mldr; while
before it required Debian 11 or Ubuntu 20.04.</p><p>The new <code>x86_64-unknown-linux-musl</code> triple can be used to generate <strong>full static</strong>
without <strong>any dependencies</strong> to the <code>libstdc++, libc, ...</code>.</p><p>For instance, given this code:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#000;font-weight:700>use</span><span style=color:#bbb> </span>lief;<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>use</span><span style=color:#bbb> </span>lief::generic::Section;<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>fn</span> <span style=color:#900;font-weight:700>main</span>()<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>let</span><span style=color:#bbb> </span>path<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>std::env::args().last().unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>let</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>mut</span><span style=color:#bbb> </span>file<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>std::fs::File::open(path).expect(<span style=color:#d14>&#34;Can&#39;t open the file&#34;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>if</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>let</span><span style=color:#bbb> </span><span style=color:#0086b3>Some</span>(lief::Binary::<span style=color:teal>PE</span>(pe))<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>lief::Binary::from(<span style=color:#000;font-weight:700>&amp;</span><span style=color:#000;font-weight:700>mut</span><span style=color:#bbb> </span>file)<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>for</span><span style=color:#bbb> </span>section<span style=color:#bbb> </span><span style=color:#000;font-weight:700>in</span><span style=color:#bbb> </span>pe.sections()<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#bbb>            </span>println!(<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#bbb>                </span><span style=color:#d14>&#34;</span><span style=color:#d14>{:20}</span><span style=color:#d14>: [0x</span><span style=color:#d14>{:016x}</span><span style=color:#d14>-0x</span><span style=color:#d14>{:016x}</span><span style=color:#d14>]&#34;</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#bbb>                </span>section.name(),<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#bbb>                </span>section.virtual_address(),<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#bbb>                </span>section.virtual_address()<span style=color:#bbb> </span><span style=color:#000;font-weight:700>+</span><span style=color:#bbb> </span>section.virtual_size()<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb> </span><span style=color:#458;font-weight:700>u64</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#bbb>            </span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#bbb>        </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#bbb>    </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><p>We can generate a dependencies-free executable by running:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#555>$</span> cargo build <span style=color:#000;font-weight:700>[</span>--release<span style=color:#000;font-weight:700>]</span> --target x86_64-unknown-linux-musl
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#555>$</span> ldd target/x86_64-unknown-linux-musl/release/reader
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#888>      statically linked
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#555>$</span> target/x86_64-unknown-linux-musl/release/reader steam.exe
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#888>.text               : [0x0000000000001000-0x00000000002cbe53]
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#888>.rdata              : [0x00000000002cc000-0x00000000003a7fa2]
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#888>.data               : [0x00000000003a8000-0x000000000043ada0]
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#888>.rsrc               : [0x000000000043b000-0x0000000000471b8c]
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#888>.reloc              : [0x0000000000472000-0x0000000000490c74]
</span></span></span></code></pre></div><h1 id=python-bindings>Python Bindings</h1><p>LIEF is now using <a href=https://nanobind.readthedocs.io/en/latest/>nanobind</a> v2.4.0 which
improves the support for typing.</p><p>Among these typing improvements, C++ enums flags are now properly inheriting
from <code>enum.Flag</code> which results in a better interface with Python code.</p><p>Additionally, typing stub files (<code>*.pyi</code>) are now generated with the nanobind&rsquo;s built-in
<code>stubgen.py</code> instead for <a href=https://github.com/python/mypy/blob/ac8957755a35a255f638c122e22c03b0e75b9a79/mypy/stubgen.py>mypy</a>.</p><h1 id=final-words>Final Words</h1><p>Additional changes are listed in the detailed <a href=https://lief.re/doc/latest/changelog.html>changelog</a>.</p><p>Many thanks to dornstetter and <a href=https://github.com/kohnakagawa>kohnakagawa</a> for their feedback
about the dyld shared cache feature.</p><p>Thank you also to <a href=https://github.com/vinogradovkonst>Konstantin Vinogradov</a> and
<a href=https://github.com/mateeuslinno>dctoralves</a> for their sponsorship.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>All the patches have been PR-submitted to the LLVM. You can check
<a href=https://lief.re/doc/latest/extended/intro.html#lief-extended-llvm>LIEF & LLVM</a> for the details&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class="d-flex flex-column flex-sm-row align-items-center border-top border-gray-200 mt-6 py-5"><div class=media><div class="avatar mr-4"><img src=https://lief.re/img/avatar/romain.png class="avatar-image rounded-circle" alt=Avatar></div><div class=media-body><span class="text-darkblue text-uppercase-xs font-weight-bolder"><a href=https://www.romainthomas.fr target=_blank>Romain Thomas
</a></span><span class="text-muted font-size-sm d-block">Posted on December 10, 2024</span></div></div></div></div></div></div></section><footer class="footer footer-dark bg-dark"><div class="container text-center"><div class=row><div class="col-12 col-md"><h6 class="footer-header mb-4 pb-md-2">LIEF</h6><a href=https://github.com/lief-project/LIEF class=footer-link>Github
</a><a href=https://lief.re//download class="footer-link mt-2">Download
</a><a href=https://lief.re//doc/latest class="footer-link mt-2">Documentation</a></div><div class="col-12 col-md mt-5 mt-md-0"><h6 class="footer-header mb-4 pb-md-2">Quarkslab</h6><a href=https://blog.quarkslab.com/ class=footer-link>Blog
</a><a href=https://quarkslab.com/ class="footer-link mt-2">Website</a></div><div class="col-12 col-md mt-5 mt-md-0"><h6 class="footer-header mb-4 pb-md-2">Other Tools</h6><a href=https://qbdi.quarkslab.com/ class=footer-link>QBDI
</a><a href=https://triton.quarkslab.com/ class="footer-link mt-2">Triton</a></div></div><div class="d-flex justify-content-center mt-6"><a href=https://infosec.exchange/@rh0main class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-mastodon fa-lg"></i>
</span></a><a href=https://x.com/lief_project class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-x-twitter fa-lg"></i>
</span></a><a href=https://crates.io/crates/lief class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-rust fa-lg"></i>
</span></a><a href=https://pypi.org/project/lief/ class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-python fa-lg"></i>
</span></a><a href=https://github.com/lief-project/LIEF class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-github fa-lg"></i>
</span></a><a href=https://discord.gg/jGQtyAYChJ class="hover-lift-light text-decoration-none mx-2"><span class="icon-circle footer-social-icon"><i class="fab fa-discord fa-lg"></i></span></a></div></div></footer><script src=https://lief.re//js/vendor.min.js></script><script src=https://lief.re//js/theme.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js></script><script>$("#copy").tooltip({trigger:"click",placement:"bottom"});function setTooltip(e){$("#copy").tooltip("hide").attr("data-original-title",e).tooltip("show")}function hideTooltip(){setTimeout(function(){$("#copy").tooltip("hide")},1e3)}var clipboard=new ClipboardJS("#copy");clipboard.on("success",function(){setTooltip("Copied!"),hideTooltip()}),clipboard.on("error",function(){setTooltip("Failed!"),hideTooltip()})</script></body></html>